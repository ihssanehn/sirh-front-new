<input type="file" style="display: none" id="uploadAvatar"
       #inputFile
       accept="image/jpeg"
       multiple (change)="filechanged($event); inputFile.value=''"/>
<div class="container top-container">
  <div class="header">
    <div class="btns left-btns">
      <app-button
        [text]="'Annuler'"
        [type]="'secondary_2'"
        [routerLink]="['/users']"
      ></app-button>
    </div>
    <h1 class="main-title">Informations du profil</h1>
    <div class="btns right-btns">
      <app-button
        [text]="'Précédent'"
        [type]="'primary_inverse'"
        [iconLeft]="'icon-arrow-left'"
        (onClick)="move(-1)"
      ></app-button>&nbsp;&nbsp;
      <app-button
        [text]="'Suivant'"
        [type]="'primary'"
        [iconRight]="'icon-arrow-right'"
        (onClick)="saveUser()"
      ></app-button>
    </div>
  </div>

  <div class="error-pannel" *ngIf="userFormGroup && !userFormGroup.valid && userFormGroup.dirty && error?.length>0"><i class="fa fa-exclamation-triangle" aria-hidden="true"></i>{{error}}</div>
  <div class="warning-pannel" *ngIf="warning?.length>0">{{warning}}</div>
  <ng-container *ngIf="!errorLoadData; else dataNotFound">
    <ng-container *ngIf="loadingData; else loadedData">
      <div class="loading">
        <img src="assets/images/loader.gif" />
      </div>
    </ng-container>
    <ng-template #loadedData>
      <div class="container-fluid top-container p-0">
        <!--    <div class="goback col-12"-->
        <!--         (click)="goback()"-->
        <!--          style="margin-bottom: 10px">-->
        <!--        <i class="fa fa-arrow-left"></i> &nbsp;{{'GO BACK' | translate}}-->
        <!--    </div>-->
        <form (submit)="submit()" *ngIf="userFormGroup" [formGroup]="userFormGroup" autocomplete="off" class="container p-0"
              novalidate>
          <h5 *ngIf="title">
            <i [ngClass]="{'icon-user-profil-2': type === 'collab', 'icon-user-profil-3': type === 'collab-user' }"></i>&nbsp;
            Ajouter un {{title}}
            <!--          <i class="icon-close float-right pointer" (click)="modal.dismiss()"></i>-->
          </h5>
          <div class="row form-box">
            <div class="main-container col-xl-6 col-12 form-column">
              <div class="col-12 white-box">
                <h5>Paramètres Supplémentaires (1/2)</h5>
                <div class="form-bloc">
                  <div class="row">
                    <label class="col-2">Civilité {{isRequired(formInputs.civility)}}</label>
                    <div class="col">
                      <div class="btn-group civilite" role="group" ngbRadioGroup name="radioBasic"
                           [formControl]="userFormGroup.controls[formInputs.civility]">
                        <label ngbButtonLabel class="btn">
                          <input ngbButton type="radio" class="btn-check" [value]="'M'"> Homme
                        </label>
                        <label ngbButtonLabel class="btn">
                          <input ngbButton type="radio" class="btn-check" [value]="'Mme'"> Femme
                        </label>
                      </div>
                      <div class="form-control-feedback"
                           *ngIf="userFormGroup.controls[formInputs.civility].hasError('required')
                    && userFormGroup.controls[formInputs.civility].dirty">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                        La civilité est obligatoire
                      </div>
                    </div>
                  </div>
                  <div class="row">
                      <label class="col-2">Nom {{isRequired(formInputs.last_name)}}</label>
                      <div class="col">
                        <input type="text"
                               placeholder="Saisir le nom ici"
                               class="form-control input"
                               [formControl]="userFormGroup.controls[formInputs.last_name]"
                               [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.last_name].hasError('required')   && userFormGroup.controls[formInputs.last_name].dirty}"
                        />
                        <div class="form-control-feedback"
                             *ngIf="userFormGroup.controls[formInputs.last_name].hasError('required')
                    && userFormGroup.controls[formInputs.last_name].dirty">
                          <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                          Le nom est obligatoire
                        </div>
                      </div>
                  </div>
                  <div class="row">
                    <label class="col-2">Prénom {{isRequired(formInputs.first_name)}}</label>
                    <div class="col">
                      <input type="text"
                             placeholder="Saisir le prénom ici"
                             [formControl]="userFormGroup.controls[formInputs.first_name]"
                             class="form-control input"
                             [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.first_name].hasError('required')
                                  && userFormGroup.controls[formInputs.first_name].dirty}"
                      />
                      <div class="form-control-feedback"
                           *ngIf="userFormGroup.controls[formInputs.first_name].hasError('required')
                    && userFormGroup.controls[formInputs.first_name].dirty">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                        Le prénom est obligatoire
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <label class="col-2">Email {{isRequired(formInputs.email_personal)}}</label>
                    <div class="col">
                      <input
                        type="email"
                        placeholder="Saisir l'adresse email ici"
                        class="form-control input"
                        [formControl]="userFormGroup.controls[formInputs.email_personal]"
                        [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.email_personal].hasError('required')
                                      && userFormGroup.controls[formInputs.email_personal].dirty}"
                      />
                      <div class="form-control-feedback"
                           *ngIf="userFormGroup.controls[formInputs.email_personal].hasError('required')
                    && userFormGroup.controls[formInputs.email_personal].dirty">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                        L'adresse email est obligatoire
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <label class="col-2">Numéro de téléphone {{isRequired(formInputs.telephone_personal)}}</label>
                    <div class="col">
                      <input type="text"
                             placeholder="Saisir le numéro de téléphone ici"
                             class="form-control input"
                             [formControl]="userFormGroup.controls[formInputs.telephone_personal]"
                             [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.telephone_personal].hasError('required')
                                  && userFormGroup.controls[formInputs.telephone_personal].dirty}"
                      />
                      <div class="form-control-feedback"
                           *ngIf="userFormGroup.controls[formInputs.telephone_personal].hasError('required')
                    && userFormGroup.controls[formInputs.telephone_personal].dirty">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                        Le numéro de téléphone est obligatoire
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col">
                      <label class="col-2">Ville {{isRequired(formInputs.city)}}</label>
                      <div class="col">
                        <input type="text"
                               placeholder="Saisir le code postal ici"
                               class="form-control input"
                               [formControl]="userFormGroup.controls[formInputs.city]"
                               [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.city].hasError('required')
                                  && userFormGroup.controls[formInputs.city].dirty}"
                        />
                        <div class="form-control-feedback"
                             *ngIf="userFormGroup.controls[formInputs.city].hasError('required')
                    && userFormGroup.controls[formInputs.city].dirty">
                          <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                          La ville est obligatoire
                        </div>
                      </div>
                    </div>
                    <div class="col">
                      <label class="col-2">Code postal {{isRequired(formInputs.code_postal)}}</label>
                      <div class="col">
                        <input type="text"
                               placeholder="Saisir le code postal ici"
                               class="form-control input"
                               [formControl]="userFormGroup.controls[formInputs.code_postal]"
                               [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.code_postal].hasError('required')
                                  && userFormGroup.controls[formInputs.code_postal].dirty}"
                        />
                        <div class="form-control-feedback"
                             *ngIf="userFormGroup.controls[formInputs.code_postal].hasError('required')
                    && userFormGroup.controls[formInputs.code_postal].dirty">
                          <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                          Le code postal est obligatoire
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col">
                      <label class="col-2">Date de naissance {{isRequired(formInputs.birthday)}}</label>
                      <div class="col">
                        <owl-date-time #owl_dt3 [pickerType]="'calendar'" ></owl-date-time>
                        <input [owlDateTime]="owl_dt3"
                               class="form-control input date"
                               [owlDateTimeTrigger]="owl_dt3"
                               placeholder="Choisir la date d'entée ici"
                               [ngClass]="{'is-invalid error-input':
                               userFormGroup.controls[formInputs.birthday].hasError('required')
                                  && userFormGroup.controls[formInputs.birthday].dirty}"
                               [formControl]="userFormGroup.controls[formInputs.birthday]"
                        />
                        <div class="form-control-feedback"
                             *ngIf="userFormGroup.controls[formInputs.birthday].hasError('required')
                    && userFormGroup.controls[formInputs.birthday].dirty">
                          <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                          La date de naissance est obligatoire
                        </div>
                      </div>
                    </div>
                    <div class="col">
                      <label class="col-2">Lieu de naissance {{isRequired(formInputs.birth_place)}}</label>
                      <div class="col">
                        <input type="text"
                               placeholder="Saisir le lieu de naissance ici"
                               class="form-control input"
                               [formControl]="userFormGroup.controls[formInputs.birth_place]"
                               [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.birth_place].hasError('required')
                                  && userFormGroup.controls[formInputs.birth_place].dirty}"
                        />
                        <div class="form-control-feedback"
                             *ngIf="userFormGroup.controls[formInputs.birth_place].hasError('required')
                    && userFormGroup.controls[formInputs.birth_place].dirty">
                          <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                          Le Lieu de naissance est obligatoire
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <label class="col-2">Adresse {{isRequired(formInputs.address)}}</label>
                    <div class="col">
                      <textarea rows="3"
                                placeholder="Saisir l'adresse ici"
                                class="form-control input"
                                [formControl]="userFormGroup.controls[formInputs.address]"
                                [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.address].hasError('required')
                                  && userFormGroup.controls[formInputs.address].dirty}"
                      ></textarea>
                      <div class="form-control-feedback"
                           *ngIf="userFormGroup.controls[formInputs.address].hasError('required')
                    && userFormGroup.controls[formInputs.address].dirty">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                        L'adresse est obligatoire
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <label class="col-2">Nationalité {{isRequired(formInputs.nationality)}}</label>
                    <div class="col">
                      <input type="text"
                             placeholder="Saisir la nationalité ici"
                             class="form-control input"
                             [formControl]="userFormGroup.controls[formInputs.nationality]"
                             [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.nationality].hasError('required')
                                  && userFormGroup.controls[formInputs.nationality].dirty}"
                      />
                      <div class="form-control-feedback"
                           *ngIf="userFormGroup.controls[formInputs.nationality].hasError('required')
                    && userFormGroup.controls[formInputs.nationality].dirty">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                        Le nationalité est obligatoire
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <label class="col-2">Numéro de sécurité sociale {{isRequired(formInputs.number_security_social)}}</label>
                    <div class="col">
                      <input type="text"
                             placeholder="Saisir le numéro de sécurité sociale ici"
                             class="form-control input"
                             [formControl]="userFormGroup.controls[formInputs.number_security_social]"
                             [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.number_security_social].hasError('required')
                                  && userFormGroup.controls[formInputs.number_security_social].dirty}"
                      />
                      <div class="form-control-feedback"
                           *ngIf="userFormGroup.controls[formInputs.number_security_social].hasError('required')
                    && userFormGroup.controls[formInputs.number_security_social].dirty">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                        Le numéro de sécurité social est obligatoire
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <label class="col-2">Situation familiale {{isRequired(formInputs.family_situation_id)}}</label>
                    <div class="col">
                      <ng-select
                        [items]="family_situations"
                        [bindLabel]="'label'"
                        [bindValue]="'id'"
                        class="form-control select"
                        placeholder="Sélectionner la situation familiale ici"
                        [formControl]="userFormGroup.controls[formInputs.family_situation_id]"
                        [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.family_situation_id].hasError('required')
                                  && userFormGroup.controls[formInputs.family_situation_id].dirty}"
                        [multiple]="false"
                      >
                      </ng-select>
                      <div class="form-control-feedback"
                           *ngIf="userFormGroup.controls[formInputs.family_situation_id].hasError('required')
                  && userFormGroup.controls[formInputs.family_situation_id].dirty">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                        La situation familiale social est obligatoire
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <label class="col-2">Matricule {{isRequired(formInputs.registration_number)}}</label>
                    <div class="col">
                      <input type="text"
                             placeholder="Saisir le matricule ici"
                             class="form-control input"
                             [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.registration_number].hasError('required')
                                  && userFormGroup.controls[formInputs.registration_number].dirty}"
                             [formControl]="userFormGroup.controls[formInputs.registration_number]"
                      />
                      <div class="form-control-feedback"
                           *ngIf="userFormGroup.controls[formInputs.registration_number].hasError('required')
                  && userFormGroup.controls[formInputs.registration_number].dirty">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                        Le matricule est obligatoire
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="main-container  col-xl-6 col-12 form-column">
              <div class="col-12 white-box">
                <h5>Paramètres Supplémentaires (2/2)</h5>
                <div style="margin-bottom: 20px;" class="form-bloc">
                  <div class="row">
                    <label class="col-2">Centre de profit {{isRequired(formInputs.cp_id)}}</label>
                    <div class="col">
                      <ng-select
                        [items]="profit_centers"
                        [bindLabel]="'label'"
                        [bindValue]="'id'"
                        class="form-control select"
                        placeholder="Sélectionner le centre de profit ici"
                        [formControl]="userFormGroup.controls[formInputs.cp_id]"
                        [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.cp_id].hasError('required')
                                  && userFormGroup.controls[formInputs.cp_id].dirty}"
                        [multiple]="false"
                      >
                      </ng-select>
                      <!--                  <input type="text"-->
                      <!--                         placeholder="Saisir le matricule ici"-->
                      <!--                         class="form-control input"-->
                      <!--                         [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.cp_id].hasError('required')-->
                      <!--                                  && userFormGroup.controls[formInputs.cp_id].dirty}"-->
                      <!--                         [formControl]="userFormGroup.controls[formInputs.cp_id]"-->
                      <!--                  />-->
                      <div class="form-control-feedback"
                           *ngIf="userFormGroup.controls[formInputs.cp_id].hasError('required')
                  && userFormGroup.controls[formInputs.cp_id].dirty">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                        Le centre de profit est obligatoire
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <label class="col-2">Manager {{isRequired(formInputs.manager_id)}}</label>
                    <div class="col">
                      <ng-select
                        [items]="managers"
                        [bindLabel]="'full_name'"
                        [bindValue]="'id'"
                        class="form-control select"
                        placeholder="Sélectionner le manager ici"
                        [formControl]="userFormGroup.controls[formInputs.manager_id]"
                        [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.manager_id].hasError('required')
                                  && userFormGroup.controls[formInputs.manager_id].dirty}"
                        [multiple]="false"
                      >
                      </ng-select>
                      <!--                  <input type="text"-->
                      <!--                         placeholder="Saisir le matricule ici"-->
                      <!--                         class="form-control input"-->
                      <!--                         [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.manager_id].hasError('required')-->
                      <!--                                  && userFormGroup.controls[formInputs.manager_id].dirty}"-->
                      <!--                         [formControl]="userFormGroup.controls[formInputs.manager_id]"-->
                      <!--                  />-->
                      <div class="form-control-feedback"
                           *ngIf="userFormGroup.controls[formInputs.manager_id].hasError('required')
                  && userFormGroup.controls[formInputs.manager_id].dirty">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                        Le manager est obligatoire
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <label class="col-2">Validateur de congé {{isRequired(formInputs.validator_absence_id)}}</label>
                    <div class="col">
                      <!--                  <input type="text"-->
                      <!--                         placeholder="Saisir le matricule ici"-->
                      <!--                         class="form-control input"-->
                      <!--                         [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.validator_absence_id].hasError('required')-->
                      <!--                                  && userFormGroup.controls[formInputs.validator_absence_id].dirty}"-->
                      <!--                         [formControl]="userFormGroup.controls[formInputs.validator_absence_id]"-->
                      <!--                  />-->
                      <ng-select
                        [items]="managers"
                        [bindLabel]="'full_name'"
                        [bindValue]="'id'"
                        class="form-control select"
                        placeholder="Sélectionner le validateur de congé ici"
                        [formControl]="userFormGroup.controls[formInputs.validator_absence_id]"
                        [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.validator_absence_id].hasError('required')
                                  && userFormGroup.controls[formInputs.validator_absence_id].dirty}"
                        [multiple]="false"
                      >
                      </ng-select>
                      <div class="form-control-feedback"
                           *ngIf="userFormGroup.controls[formInputs.validator_absence_id].hasError('required')
                  && userFormGroup.controls[formInputs.validator_absence_id].dirty">
                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>
                        Le validateur de congé est obligatoire
                      </div>
                    </div>
                  </div>
<!--                  <div class="row">-->
<!--                    <label class="col-2">Profil {{isRequired(formInputs.profile_id)}}</label>-->
<!--                    <div class="col">-->
<!--                      <ng-select-->
<!--                        [items]="profiles"-->
<!--                        [bindLabel]="'label'"-->
<!--                        [bindValue]="'id'"-->
<!--                        class="form-control select"-->
<!--                        placeholder="Sélectionner le profil ici"-->
<!--                        [formControl]="userFormGroup.controls[formInputs.profile_id]"-->
<!--                        [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.profile_id].hasError('required')-->
<!--                                  && userFormGroup.controls[formInputs.profile_id].dirty}"-->
<!--                        [multiple]="false"-->
<!--                      >-->
<!--                      </ng-select>-->

<!--                      <div class="form-control-feedback"-->
<!--                           *ngIf="userFormGroup.controls[formInputs.validator_absence_id].hasError('required')-->
<!--                  && userFormGroup.controls[formInputs.validator_absence_id].dirty">-->
<!--                        <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>-->
<!--                        Le profil est obligatoire-->
<!--                      </div>-->
<!--                    </div>-->
<!--                  </div>-->
                  <div class="row">
                    <label class="col-2">Utilisateur virtuel {{isRequired(formInputs.is_virtual)}}</label>
                    <div class="col">
                      <div class="btn-group boolean-button" role="group" >
                        <input type="radio" [formControl]="userFormGroup.controls[formInputs.is_virtual]"
                               [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.is_virtual].hasError('required')
                                  && userFormGroup.controls[formInputs.is_virtual].dirty}"
                               [value]="false"
                               class="btn-check"
                               id="is_virtual_1"
                               name="is_virtual"
                               autocomplete="off">
                        <label class="btn btn-outline-primary" for="is_virtual_1">Non</label>

                        <input type="radio"
                               [formControl]="userFormGroup.controls[formInputs.is_virtual]"
                               [ngClass]="{'is-invalid error-input': userFormGroup.controls[formInputs.is_virtual].hasError('required')
                                  && userFormGroup.controls[formInputs.is_virtual].dirty}"
                               [value]="true"
                               class="btn-check"
                               id="is_virtual_2"
                               name="is_virtual"
                               autocomplete="off">
                        <label class="btn btn-outline-primary" for="is_virtual_2">Oui</label>
                      </div>

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>


      </div>
    </ng-template>
  </ng-container>
</div>



<ng-template #emptyState>
  <app-centred-message [message]="( 'Pas d\'utilisateur/collaborateur trouvé pour le moment' | translate )"
                       [image]="'images/emptystate.png'"
  ></app-centred-message>
</ng-template>

<ng-template #dataNotFound>
  <app-centred-message [message]="'DATA LOADING ERROR' | translate"
                       [image]="'images/error404.png'">
  </app-centred-message>
</ng-template>
