<div class="list container top-container">
<!--    <div class="foback-header">-->
<!--&lt;!&ndash;      <app-button&ndash;&gt;-->
<!--&lt;!&ndash;        [text]="'Retour'"&ndash;&gt;-->
<!--&lt;!&ndash;        [type]="'tertiary'"&ndash;&gt;-->
<!--&lt;!&ndash;        [iconLeft]="'icon-go-back'"&ndash;&gt;-->
<!--&lt;!&ndash;      ></app-button>&ndash;&gt;-->
<!--      <div class="right-buttons">-->
<!--&lt;!&ndash;        <app-button&ndash;&gt;-->
<!--&lt;!&ndash;          [text]="'Importer'"&ndash;&gt;-->
<!--&lt;!&ndash;          [type]="'tertiary'"&ndash;&gt;-->
<!--&lt;!&ndash;          [iconLeft]="'icon-file'"&ndash;&gt;-->
<!--&lt;!&ndash;          [customStyle]="{'white-space': 'nowrap'}"&ndash;&gt;-->
<!--&lt;!&ndash;        ></app-button>&nbsp;&ndash;&gt;-->
<!--&lt;!&ndash;        <app-button&ndash;&gt;-->
<!--&lt;!&ndash;          [text]="'Exporter'"&ndash;&gt;-->
<!--&lt;!&ndash;          [type]="'tertiary'"&ndash;&gt;-->
<!--&lt;!&ndash;          [iconLeft]="'icon-file'"&ndash;&gt;-->
<!--&lt;!&ndash;          [customStyle]="{'white-space': 'nowrap'}"&ndash;&gt;-->
<!--&lt;!&ndash;        ></app-button>&ndash;&gt;-->
<!--        &nbsp;-->
<!--        <app-button-->
<!--          [text]="'Ajouter un utilisateur/collaborateur'"-->
<!--          [type]="'primary'"-->
<!--          [iconLeft]="'fa fa-plus'"-->
<!--          (onClick)="openSelectRole()"-->
<!--          [customStyle]="{'white-space': 'nowrap'}"-->
<!--        ></app-button>-->
<!--      </div>-->
<!--    </div>-->
    <div class="sub-header ">
      <h1 class="main-title">
       {{sectionName}}
      </h1>

      <div class="search d-flex">
        <div class="input-group">
          <input type="text"
                 class="form-control input"
                 placeholder="Rechercher un utilisateur"
                 (input)="getUsers()"
                 aria-describedby="basic-addon2"
                 [(ngModel)]="filter.keyword"/>
          <div class="input-group-append" id="basic-addon2">
            <i class="icon-search"></i>
          </div>
        </div>&nbsp;
        <app-button
          [text]="'Rechercher'"
          [type]="'primary_light'"
          [iconLeft]="'icon-search'"
          (onClick)="getUsers()"
          [customStyle]="{'white-space': 'nowrap'}"
        ></app-button>&nbsp;
        <app-button
          [text]="'Recherche avancé'"
          [iconRight]="showFilters ? 'icon-arrow-up': 'icon-arrow-down'"
          [type]="'tertiary'"
          (onClick)="showFilters = !showFilters; resetFilters()"
          [customStyle]="{'white-space': 'nowrap'}"
        ></app-button>
      </div>
      <div class="right-buttons">
        <app-button
          [text]="'Ajouter ' + type"
          [type]="'secondary'"
          [iconRight]="'icon-add'"
          (onClick)="openSelectRole(type)"
          [customStyle]="{'white-space': 'nowrap'}"
        ></app-button>
      </div>
    </div>
  <div class="filter-container" *ngIf="showFilters">
    <h3 class="filter-tilte-bloc ">
      <span>Recherche avancée</span>
      <span class="reset-filters" (click)="resetFilters()">
          <i class="icon-close"></i>&nbsp;
          Réinitialiser les filtres
        </span>
    </h3>
    <div class="filtres row ">
      <div class="flex-column col-12 col-sm-6 col-lg-3  ">
        <label>Type de profil</label>
        <div>
          <ng-select class="select form-control"
                     [multiple]="true"
                     [items]="profiles"
                     (change)="filterChanged()"
                     [(ngModel)]="filter.profiles"
                     [bindLabel]="'label'"
                     [bindValue]="'id'"
                     [placeholder]="'Filtrer par profils'" ></ng-select>
        </div>
      </div>
      <div class=" flex-column  col-12 col-sm-6 col-lg-3 ">
        <label>Business line</label>
        <div>
          <ng-select class="select form-control"
                     [multiple]="true"
                     [items]="business_lines"
                     [bindLabel]="'label'"
                     [bindValue]="'id'"
                     (change)="filterChanged()"
                     [(ngModel)]="filter.business_lines"
                     [placeholder]="'Filtrer business lines'" ></ng-select>
        </div>
      </div>
      <div class=" flex-column  col-12 col-sm-6 col-lg-3 ">
        <label>Direction OP</label>
        <div>
          <ng-select class="select form-control"
                     [multiple]="true"
                     [items]="op_directions"
                     [bindLabel]="'label'"
                     [bindValue]="'id'"
                     (change)="filterChanged()"
                     [(ngModel)]="filter.op_directions"
                     [placeholder]="'Filtrer direction op'"></ng-select>
        </div>
      </div>
      <div class=" flex-column  col-12 col-sm-6 col-lg-3 ">
        <label>Business unit</label>
        <div>
          <ng-select class="select form-control"
                     [multiple]="true"
                     [items]="business_units"
                     [bindLabel]="'label'"
                     [bindValue]="'id'"
                     (change)="filterChanged()"
                     [(ngModel)]="filter.business_units"
                     [placeholder]="'Filtrer par business units'"></ng-select>
        </div>
      </div>
    </div>
    <div class="filtres row ">
      <div class="flex-column col-12 col-sm-6 col-lg-3  ">
        <label>Département</label>
        <div>
          <ng-select class="select form-control"
                     [multiple]="true"
                     [items]="departments"
                     (change)="filterChanged()"
                     [(ngModel)]="filter.departments"
                     [bindLabel]="'label'"
                     [bindValue]="'id'"
                     [placeholder]="'Filtrer par département'" ></ng-select>
        </div>
      </div>
      <div class=" flex-column  col-12 col-sm-6 col-lg-3 ">
        <label>Centre de profit</label>
        <div>
          <ng-select class="select form-control"
                     [multiple]="true"
                     [items]="profit_centers"
                     [bindLabel]="'label'"
                     [bindValue]="'id'"
                     (change)="filterChanged()"
                     [(ngModel)]="filter.profit_centers"
                     [placeholder]="'Filtrer par cenntre de profit'" ></ng-select>
        </div>
      </div>
      <div class=" flex-column  col-12 col-sm-6 col-lg-3 ">
        <label>Appartenance</label>
        <div>
          <ng-select class="select form-control"
                     [multiple]="true"
                     [items]="memberships"
                     [bindLabel]="'label'"
                     [bindValue]="'id'"
                     (change)="filterChanged()"
                     [(ngModel)]="filter.member_ships"
                     [placeholder]="'Filtrer par appartenance'"></ng-select>
        </div>
      </div>
      <div class=" flex-column  col-12 col-sm-6 col-lg-3 ">
        <label>Rôle</label>
        <div>
          <ng-select class="select form-control"
                     [multiple]="true"
                     [items]="roles"
                     [bindLabel]="'label'"
                     [bindValue]="'id'"
                     (change)="filterChanged()"
                     [(ngModel)]="filter.roles"
                     [placeholder]="'Filtrer par rôles'"></ng-select>
        </div>
      </div>
    </div>
    <div class="filtres row ">
      <div class="flex-column col-12 col-sm-6 col-lg-3  ">
        <label>Etat de facturation</label>
        <div>
          <ng-select class="select form-control"
                     [multiple]="true"
                     [items]="facturation_stats"
                     (change)="filterChanged()"
                     [(ngModel)]="filter.facturation_stats"
                     [bindLabel]="'label'"
                     [bindValue]="'id'"
                     [placeholder]="'Filtrer par état de facturation'" ></ng-select>
        </div>
      </div>
      <div class=" flex-column  col-12 col-sm-6 col-lg-3 ">
        <label>Etat à compléter</label>
        <div>
          <ng-select class="select form-control"
                     [multiple]="true"
                     [items]="states_to_complete"
                     [bindLabel]="'label'"
                     [bindValue]="'id'"
                     (change)="filterChanged()"
                     [(ngModel)]="filter.stats_to_complete"
                     [placeholder]="'Filtrer contrat'" ></ng-select>
        </div>
      </div>
      <div class=" flex-column  col-12 col-sm-6 col-lg-3 ">
        <label>Etat matricule</label>
        <div>
          <ng-select class="select form-control"
                     [multiple]="true"
                     [items]="matricule_stats"
                     [bindLabel]="'label'"
                     [bindValue]="'id'"
                     (change)="filterChanged()"
                     [(ngModel)]="filter.matricule_stats"
                     [placeholder]="'Filtrer par état matricule'"></ng-select>
        </div>
      </div>
      <div class="flex-column col-12 col-sm-6 col-lg-3  ">
        <label>Salarié</label>
        <div>
          <ng-select class="select form-control"
                     [multiple]="true"
                     [items]="personals"
                     (change)="filterChanged()"
                     [(ngModel)]="filter.personals"
                     [bindLabel]="'full_name'"
                     [bindValue]="'id'"
                     [placeholder]="'Filtrer par salarié'" ></ng-select>
        </div>
      </div>
    </div>
    <div class="filtres row">
      <div class="flex-column  col-12 col-sm-6 col-lg-3  block-check ">
        <label class="">Etat de l'utilisateur</label>
        <div class="btn-group btn-group-toggle"
             ngbRadioGroup name="radioBasic"
             (change)="filterChanged()"
             [(ngModel)]="filter.user_stats">
          <label ngbButtonLabel
                 [ngClass]="{'btn-primary': filter.user_stats === true}">
            <input ngbButton type="radio" [value]="true"> Actif
          </label>
          <label ngbButtonLabel class="btn-primary"
                 [ngClass]="{'btn-primary': filter.user_stats === null}">
            <input ngbButton type="radio" [value]="null"> Tous
          </label>
          <label ngbButtonLabel
                 [ngClass]="{'btn-primary': filter.user_stats === false}">
            <input ngbButton type="radio" [value]="false"> Inactif
          </label>
        </div>
      </div>
      <div class="flex-column  col-12 col-sm-6 col-lg-3  block-check ">
        <label class="">Utilisateur virtuel</label>
        <div class="btn-group btn-group-toggle"
             ngbRadioGroup name="radioBasic"
             (change)="filterChanged()"
             [(ngModel)]="filter.is_virtual">
          <label ngbButtonLabel
                 [ngClass]="{'btn-primary': filter.is_virtual === true}">
            <input ngbButton type="radio" [value]="true"> Oui
          </label>
          <label ngbButtonLabel class="btn-primary"
                 [ngClass]="{'btn-primary': filter.is_virtual === null}">
            <input ngbButton type="radio" [value]="null"> Tous
          </label>
          <label ngbButtonLabel
                 [ngClass]="{'btn-primary': filter.is_virtual === false}">
            <input ngbButton type="radio" [value]="false"> Non
          </label>
        </div>
      </div>
    </div>
  </div>
    <div class="sub-header" *ngIf="showFilters || keyword?.length>0">
      <h2 class="main-title">
        Résultats de recherche
      </h2>
    </div>
  <ng-container *ngIf="!loadingData; else loadingTemplate">
    <div class="wrap" *ngIf="users?.length>0; else emptyState" >
      <div class="table-wrapper">
        <ng-container [ngSwitch]="type">
          <ng-container *ngSwitchCase="'general'">
            <table class="table-responsive card-list-table">
              <thead>
                <tr>
                <th>
                  Matricule
                </th>
                <th>
                  Salarié
                </th>
                <th>
                  Profil
                </th>
                <th>
                  Rôle
                </th>
                <th>
                  Centre de profit
                </th>
                <th>
                  Appartenance
                </th>
                <th>
                  Entrée
                </th>
                <th>
                  Sortie
                </th>
                <th>
                  Téléphone
                </th>
                <th>
                  Email
                </th>
                <th>
                  Dernière connexion
                </th>
                <th style="text-align: right;">Action</th>
              </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of users"  >
                  <td data-title="Numéro de registration" >{{user?.registration_number}}</td>
                  <td>
                    <div class="photo-cell" [routerLink]="['/users/details/'+user.id]">
                      <div class="photo">
                        <div class="img-container">
                          <img
                            [attr.src]="user?.photo_profile ? (user.photo_profile |
                        getPhotoFromBackend: ('assets/images/'+(user?.civility === 'Mme' ? 'woman.png': 'man.png')) |
                        async) : ('assets/images/'+(user?.civility === 'Mme' ? 'woman.png': 'man.png'))"
                          />
                        </div>
                      </div>
                      <div class="name">{{user?.full_name}} </div>
                    </div>
                  </td>
                  <td data-title="Profile" >{{user?.profile_name}}</td>
                  <td data-title="Rôle" >{{user?.role_name}}</td>
                  <td data-title="Ceentre de profit"  >{{user?.cp_name}}</td>
                  <td data-title="Appartenance" >{{user?.member_ship_name}}</td>
                  <td data-title="Entrée"  >{{user?.entry_date | dateMessage}}</td>
                  <td data-title="Sortie"  >{{user?.end_date | dateMessage}}</td>
                  <td data-title="Telephone portable">{{user?.telephone_portable}}</td>
                  <td data-title="Email">{{user?.email}}</td>
                  <td>{{user?.last_login | timeAgo}} </td>
                  <td style="text-align: right;padding-right: 0;">
                    <div class="actions">
                      <i class="icon-eye"
                         data-toggle="tooltip"
                         data-placement="top"
                         (click)="goToUpdateUser(user)"
                         title="Détails"></i>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </ng-container>
          <ng-container *ngSwitchCase="'period_essai'">
            <table class="table-responsive card-list-table">
              <thead>
               <tr>
                 <th>
                   Matricule
                  </th>
                  <th>
                    Salarié
                  </th>
                 <th>
                   Centre de profit
                 </th>
                <th>
                  Statut salarié
                </th>
                <th>
                  Date entrée
                </th>
                <!-- <th>
                  Ancienneté
                </th> -->
                <th>
                  Décision
                </th>
                <th>
                  Date de fin de renouvellement
                </th>
                <!-- <th>
                  Suivi evolution période d'essai
                </th> -->
                <th>
                  Date fin période essai
                </th>
                <th>
                  Date sortie
                </th>
                <th>
                  Courrier P.E signé
                </th>
                 <th>
                  Réception bilan PE
                </th>
               </tr>
              </thead>
              <tbody>
              <tr *ngFor="let pe of users"  >
                <td data-title="Numéro de registration" >{{pe?.personal?.registration_number}}</td>
                <td>
                  <div class="photo-cell"  [routerLink]="['/users/details']" [queryParams]="{step: 1, user_id: pe.personal_id}">
                    <div class="photo">
                      <div class="img-container">
                        <img
                          [attr.src]="user?.photo_profile ? (user.photo_profile |
                        getPhotoFromBackend: ('assets/images/'+(pe?.personal?.civility === 'Mme' ? 'woman.png': 'man.png')) |
                        async) : ('assets/images/'+(pe?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png'))"
                        />
                      </div>
                    </div>
                    <div class="name">{{pe?.personal?.nom}} {{pe?.personal?.prenom}} </div>
                  </div>
                </td>
                <td data-title="Centre de profit" class="tel">{{pe?.personal?.manager?.nom}} {{pe?.personal?.manager?.nom}}</td>
                <td data-title="Rôle" >{{pe?.personal?.status?.label || 'status_personal'}}</td>
                <td data-title="Entrée" class="tel">{{ (pe?.personal?.entry_date | dateMessage) || 'N.R'}}</td>
                <td data-title="Numéro de registration" >{{pe?.decision?.label || 'à confirmer' }}</td>
                <td data-title="Sortie" class="tel">{{(pe?.renewal_date | dateMessage) || 'N.R'}}</td>
                <td data-title="Sortie" class="tel">{{(pe?.end_date | dateMessage) || 'N.R'}}</td>
                <td data-title="Sortie" class="tel">{{(pe?.personal?.end_date | dateMessage) || 'N.R'}}</td>
                <ng-container *ngFor="let histo of pe?.historiques_actions">
                  <td>
                    <div class="check-box-btn"  [matTooltip]="histo?.user ? ('Validé par ' +histo?.user?.prenom + ' ' + histo?.user?.nom + ' le '+ (histo?.done_at | dateMessage)):''">
                      <input type="checkbox"
                             class="small-checkbox"
                             [disabled]="histo?.checked"
                             [ngClass]="{'disabled': histo?.checked}"
                             id="with_inactive_cp"
                             (change)="markActionAsDone(histo.id, histo.checked)"
                             [checked]="histo?.checked"
                             [(ngModel)]="histo.checked"
                             name="checbox_" >
                    </div>
                  </td>
              </ng-container>

              </tr>
              </tbody>
            </table>
          </ng-container>
          <ng-container *ngSwitchCase="'entretien'">
            <table class="table-responsive card-list-table">
              <thead>
              <tr>
                <th>Matricule</th>
                <th>Salarié</th>
                <th>Société</th>
                <th>Date entrée</th>
                <th>Centre de profit</th>
                <th>Type entretien</th>
                <th>Date théorique</th>
                <th>Date effective</th>
                <th>Etat</th>
                <th>Pièces jointes</th>
                <th style="text-align: right">Actions</th>
              </tr>
              </thead>
              <tbody>
                <tr *ngFor="let interview of users"  >
                  <td>{{interview?.personal?.registration_number}}</td>
                  <td>
                    <div class="photo-cell"  [routerLink]="['/users/details']" [queryParams]="{step: 2, user_id: interview?.personal_id}">
                      <div class="photo">
                        <div class="img-container">
                          <img
                            [attr.src]="entrance?.photo_profile ? (user.photo_profile |
                          getPhotoFromBackend: ('assets/images/'+(interview?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png')) |
                          async) : ('assets/images/'+(interview?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png'))"
                            />
                        </div>
                      </div>
                      <div class="name">{{interview?.personal?.nom}} {{interview?.personal?.prenom}} </div>
                    </div>
                  </td>
                  <td>{{interview?.personal?.entity?.label || 'entity_name'}}</td>
                  <td>{{ (interview?.personal?.entry_date | dateMessage )|| 'date entree'}}</td>
                  <td>{{interview?.personal?.manager?.nom}} {{interview?.personal?.manager?.prenom}}</td>
                  <td>{{interview?.type?.label || 'entretien_type'}}</td>
                  <td>
                    {{interview?.theoretical_date | dateMessage}}
                  </td>
                  <td>
                    <div class="d-flex align-items-center">
                      <owl-date-time #owl_dt1 [pickerType]="'calendar'"
                      ></owl-date-time>
                      <input [owlDateTime]="owl_dt1"
                             class="form-control input date"
                             [owlDateTimeTrigger]="owl_dt1"
                             [placeholder]="'Sélectionner une date'"
                             [(ngModel)]="interview.effective_date"
                             style="width: 0;margin: 0; padding: 0;visibility: hidden"
                             #effective_date_input
                             (ngModelChange)="updateDateInterview(interview.id, interview.effective_date)"
                      />
                      <span class="pointer" [ngClass]="{'link': !interview?.effective_date}" (click)="effective_date_input.click()">
                         <i class="fa fa-calendar primary-icon"></i>&nbsp; {{interview?.effective_date ? (interview?.effective_date | dateMessage): 'Ajouter une date'}}
                        </span>
                    </div>
                  </td>
                  <td>{{interview.effective_date ? 'Réalisé':'Planifiée' || 'etat'}}</td>
                  <td >
                    <!-- <span class="link">Attacher un document</span> &nbsp; -->
                    <i class="icon-attachment"></i>
                  </td>
                  <td style="padding-right: 0;">
                    <div class="actions">
                      <i class="icon-edit"
                         data-toggle="tooltip"
                         data-placement="top"
                         (click)="openSelectRole('entretien', interview)"
                         title="Modifier"></i>&nbsp;&nbsp;
                      <i class="icon-close danger-icon"
                         data-toggle="tooltip"
                         data-placement="top"
                         title="Supprimer"></i>
                    </div>
                  </td>
              </tr>
              </tbody>
            </table>
          </ng-container>
          <ng-container *ngSwitchCase="'formation'">
            <table class="table-responsive card-list-table">
              <thead>
              <tr>
                <th>Matricule</th>
                <th>Nom</th>
                <th>Profil</th>
                <th>Centre de profit</th>
                <th>Email</th>
                <th>Tel</th>
                <th class="icon-cell"></th>
              </tr>
              </thead>
              <tbody>
              <!--                [routerLink]="['/users/info/'+user.id]"  (click)="openModal()"-->
              <tr *ngFor="let user of users"  >
                <td>{{user?.registration_number}}</td>
                <td>
                  <div class="photo-cell"  [routerLink]="['/users/details/'+user.id]">
                    <div class="photo">
                      <div class="img-container">
                        <img
                          [attr.src]="user?.photo_profile ? (user.photo_profile |
                      getPhotoFromBackend: ('assets/images/'+(user?.civility === 'Mme' ? 'woman.png': 'man.png')) |
                      async) : ('assets/images/'+(user?.civility === 'Mme' ? 'woman.png': 'man.png'))"
                        />
                      </div>
                    </div>
                    <div class="name">{{user?.full_name}} </div>
                  </div>
                </td>
                <td data-title="Email" >{{user?.profile_name}}</td>
                <td data-title="Téléphonne" class="tel">{{user?.cp_name}}</td>
                <td data-title="Profil">{{user?.email_professional}}</td>
                <td data-title="Centre d'interêt">{{user?.telephone_professional}}</td>

                <!--                        <td data-title="Date de création" class="text-center">{{user?.created_at | defaultFormat }}</td>-->
                <!--                        <td data-title="Dernière activité" class="lightcell">{{user?.last_activity | timeAgo }}</td>-->
                <td >
                  <!--                            appStopPropagation-->
                  <div class="actions">
                    <i class="icon-eye"
                       data-toggle="tooltip"
                       data-placement="top"
                       (click)="goToUpdateUser(user)"
                       title="Détails"></i>
                    <!--                              <span class="d-none d-lg-flex">Détails</span>-->

                    <!--                                <ng-container *ngIf="!user.blocked_at; else unlock">-->
                    <!--                                    <i class="fa fa-lock"-->
                    <!--                                       data-toggle="tooltip"-->
                    <!--                                       data-placement="top"-->
                    <!--                                       (click)="askBlockUser(user.id)"-->
                    <!--                                       title="{{'DISABLE ACCOUNT' | translate}}"></i>-->
                    <!--                                </ng-container>-->
                    <!--                                <ng-template #unlock>-->
                    <!--                                    <i class="fa fa-unlock"-->
                    <!--                                       data-toggle="tooltip"-->
                    <!--                                       data-placement="top"-->
                    <!--                                       (click)="askUnBlockUser(user.id)"-->
                    <!--                                       title="{{'ENABLE ACCOUNT' | translate}}"></i>-->
                    <!--                                </ng-template>-->
                    <!--                                <i class="fa fa-trash"-->
                    <!--                                   (click)="archive(user.id)"-->
                    <!--                                   data-toggle="tooltip"-->
                    <!--                                   data-placement="top"-->
                    <!--                                   title="{{'DELETE' | translate}}"></i>-->
                  </div>
                </td>
              </tr>
              </tbody>
            </table>
          </ng-container>
          <ng-container *ngSwitchCase="'visite_medicale'">
            <table class="table-responsive card-list-table">
              <thead>
              <tr>
                <th>
                  Matricule
                </th>
                <th>
                  Salarié
                </th>
                <th>
                  Société
                </th>
                <th>
                  Siège
                </th>
                <th>
                  Centre médical
                </th>
                <th>
                  Date dernière visite médicale
                </th>
                <th>
                  Date prochaine visite médicale
                </th>
                <th>
                  Convocation envoyée
                </th>
                <th style="text-align: right">Actions</th>
              </tr>
              </thead>
              <tbody>
              <!--                [routerLink]="['/users/info/'+user.id]"  (click)="openModal()"-->
              <tr *ngFor="let vm of users"  >
                <td>{{vm?.personal?.registration_number}}</td>
                <td>
                  <div class="photo-cell"  [routerLink]="['/users/details']" [queryParams]="{step: 3, user_id: vm.personal_id}">
                    <div class="photo">
                      <div class="img-container">
                        <img
                          [attr.src]="user?.photo_profile ? (user.photo_profile |
                      getPhotoFromBackend: ('assets/images/'+(vm?.personal?.civility === 'Mme' ? 'woman.png': 'man.png')) |
                      async) : ('assets/images/'+(vm?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png'))"
                        />
                      </div>
                    </div>
                    <div class="name">{{vm?.personal?.nom}} {{vm?.personal?.prenom}}</div>
                  </div>
                </td>
                <td>{{vm?.personal?.entity?.label || 'entity_name'}}</td>
                <td>{{vm?.personal?.siege?.label || 'siege_name'}}</td>
                <td>
                  <ng-container *ngIf="vm.is_editting_mc; else mc_label_temp">
                    <div class="d-flex align-items-center">
                      <input id="typeahead-basic"
                             type="text"
                             class="form-control input"
                             [placeholder]="'Saisir le nom du centre médical'"
                             [(ngModel)]="vm.tmp_medical_centre"
                             [ngbTypeahead]="medical_center_search"
                      />
                      <div class="text-center d-flex text-nowrap">
                        &nbsp;&nbsp;<i class="icon-check primary-icon pointer" (click)="updateVM('centre', vm.id, vm.tmp_medical_centre)"></i>
                        &nbsp;&nbsp;<i class="icon-close danger-icon pointer" (click)="vm.is_editting_mc = false"></i>
                      </div>
                    </div>
                  </ng-container>
                  <ng-template #mc_label_temp>
                    {{vm?.centre || 'Ajouter un centre médical'}}
                    &nbsp;<i class="icon-edit-bold primary-icon pointer" (click)="openVmForEditting('centre', vm)"></i>
                  </ng-template>
                </td>
                <td>
                  <span>--</span>
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <owl-date-time #owl_dt2 [pickerType]="'calendar'"
                    ></owl-date-time>
                    <input [owlDateTime]="owl_dt2"
                           class="form-control input date"
                           [owlDateTimeTrigger]="owl_dt2"
                           [placeholder]="'Sélectionner une date'"
                           [(ngModel)]="vm.scheduled_date"
                           style="width: 0;margin: 0; padding: 0;visibility: hidden"
                           #scheduled_date_input
                           (ngModelChange)="updateVM('scheduled_date', vm.id, vm.scheduled_date)"
                    />
                    <span class="pointer" [ngClass]="{'link': !vm?.scheduled_date}" (click)="scheduled_date_input.click()">
                         <i class="fa fa-calendar primary-icon"></i>&nbsp; {{vm?.scheduled_date ? (vm?.scheduled_date | dateMessage): 'Ajouter une date'}}
                        </span>
                  </div>
                </td>
                <ng-container *ngFor="let histo of vm?.historiques_actions">
                  <td>
                    <div class="check-box-btn"  [matTooltip]="histo?.user ? ('Validé par ' +histo?.user?.prenom + ' ' + histo?.user?.nom + ' le '+ (histo?.done_at | dateMessage)):''">
                      <input type="checkbox"
                             class="small-checkbox"
                             [disabled]="histo?.checked"
                             [ngClass]="{'disabled': histo?.checked}"
                             id="with_inactive_cp"
                             (change)="markActionAsDone(histo.id, histo.checked)"
                             [checked]="histo?.checked"
                             [(ngModel)]="histo.checked"
                             name="checbox_" >
                    </div>
                  </td>
              </ng-container>
                <!-- <td>
                  <div class="check-box-btn">
                    <input type="checkbox"
                           class="small-checkbox"
                           id="invitation_sent"
                           [checked]="vm.invitation_sent"
                           [(ngModel)]="vm.invitation_sent"
                           name="invitation_sent" >
                  </div>
                </td> -->
                <td></td>
                <td>
                  <div class="actions">
                    <i class="icon-edit"
                       data-toggle="tooltip"
                       data-placement="top"
                       (click)="openSelectRole('visite_medicale', vm)"
                       title="Modifier"></i>
                  </div>
                </td>
              </tr>
              </tbody>
            </table>
          </ng-container>
          <ng-container *ngSwitchCase="'entree'">
            <table class="table-responsive card-list-table table_entree">
              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th></th>
                  <!-- <th colspan="2" class="category-cell">Salarié étranger</th> -->
                  <th></th>
                  <th></th>
                  <th></th>
                  <ng-container *ngFor="let extraColumn of getActiveColumns('columns_entree')">
                    <th>
                    </th>
                  </ng-container>
                </tr>
                <tr>
                  <th>
                    Matricule
                  </th>
                  <th>
                    Salarié
                  </th>
                  <th>
                    Société
                  </th>
                  <th>
                    Siège
                  </th>
                  <th>
                    Date d'entrée
                  </th>
                  <th>
                    Centre de profit
                  </th>
                  <th>
                    Type de contrat
                  </th>
                  <th>
                    Statut
                  </th>
                  <!-- <th>
                    Vérification TS préfecture
                  </th>
                  <th>
                    Demande d'authorisation de travail
                  </th>
                  <th>
                    Contrat signé
                  </th>
                  <th>
                    Annulé?
                  </th> -->
                  <ng-container *ngFor="let extraColumn of getActiveColumns('columns_entree')">
                      <th>
                        {{extraColumn.label}}
                      </th>
                  </ng-container>
                  <th style="text-align: center" [matTooltip]="'Selectionnez les colonnes que vous souhaitez visualiser'" class="sticky th-btn" width="2%" style="position: sticky;right:-80px;" [matMenuTriggerFor]="statusMenu">
                    <i class="fa fa-filter" ></i>
                  </th>
                  <mat-menu #statusMenu="matMenu" [class]="'profile-menu'">
                    <div mat-menu-item class="dropdown-item" *ngFor="let item of columns_entree" (click)="$event.stopPropagation()">
                      <div class="check-box-btn">
                        <input type="checkbox"
                               id="{{item.id}}"
                               [(ngModel)]="item.checked"
                               (change)="onCheckChange($event, item, statusMenu)"
                               name="{{item.id}}" >
                        <label for="{{item.id}}" >{{item.label}}</label>
                      </div>
                    </div>
                    <div mat-menu-item class="dropdown-item" (click)="$event.stopPropagation();">
                      <div class="check-box-btn" >
                        <input type="checkbox"
                               id="select_all"
                               [value]="'select_all'"
                               (change)="selectAllColumns()"
                               name="select_all" >
                        <label for="select_all" class="blue-text">Tout séléctionner</label>
                      </div>
                    </div>
                  </mat-menu>
                  <mat-menu #placeholder="matMenu" class="placeholder"></mat-menu>
                </tr>
              </thead>
              <tbody>
              <!--                [routerLink]="['/users/info/'+user.id]"  (click)="openModal()"-->
              <tr *ngFor="let entrance of users">
                <td data-title="Matricule" >{{entrance?.personal?.registration_number || 'N.R'}}</td>
                <td>
                  <div class="photo-cell"  [routerLink]="['/users/details']" [queryParams]="{step: 0, user_id: entrance.personal.id}">
                    <div class="photo">
                      <div class="img-container">
                        <img
                          [attr.src]="entrance?.photo_profile ? (user.photo_profile |
                      getPhotoFromBackend: ('assets/images/'+(entrance?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png')) |
                      async) : ('assets/images/'+(entrance?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png'))"
                        />
                      </div>
                    </div>
                    <div class="name pointer">
                        {{entrance?.personal?.nom || 'N.R'}}
                        {{entrance?.personal?.prenom || 'N.R'}}
                    </div>
                  </div>
                </td>
                <td data-title="Entité" >{{entrance?.personal?.entity.label || 'Piman Consultants'}}</td>
                <td data-title="Entité" >{{entrance?.personal?.siege?.label || 'N.R'}}</td>
                <td data-title="Entité" >{{ (entrance?.personal?.entry_date | dateMessage) || 'N.R'}}</td>
                <td data-title="Entité" >{{entrance?.personal?.manager?.prenom + ' ' + entrance?.personal?.manager?.nom  || 'NSI'}}</td>
                <td data-title="Entité" >{{entrance?.personal?.contrat.label || 'N.R'}}</td>
                <td data-title="Entité" >{{entrance?.personal?.status?.label || 'Cadre'}}</td>
                <ng-container *ngFor="let extraColumn of getActiveColumns('columns_entree')">
                    <td>
                      <div class="check-box-btn"  [matTooltip]="entrance?.slug_actions[extraColumn.slug]?.user ? ('Validé par ' +entrance?.slug_actions?.[extraColumn.slug]?.user?.prenom + ' ' + entrance?.slug_actions?.[extraColumn.slug]?.user?.nom + ' le '+ (entrance?.slug_actions?.[extraColumn.slug]?.done_at | dateMessage)):''">
                        <input type="checkbox"
                               class="small-checkbox"
                               *ngIf="entrance.slug_actions[extraColumn.slug]"
                               [disabled]="entrance?.slug_actions?.[extraColumn.slug]?.checked"
                               [ngClass]="{'disabled': entrance?.slug_actions?.[extraColumn.slug]?.checked}"
                               id="with_inactive_cp"
                               (change)="markActionAsDone(entrance.slug_actions[extraColumn.slug].id,entrance.slug_actions[extraColumn.slug].checked)"
                               [checked]="entrance?.slug_actions?.[extraColumn.slug]?.checked"
                               [(ngModel)]="entrance.slug_actions[extraColumn.slug].checked"
                               name="checbox_" >
                      </div>
                    </td>
                </ng-container>
                <td >
                  <!--                            appStopPropagation-->
                  <div class="actions">

                    <!--                              <span class="d-none d-lg-flex">Détails</span>-->

                    <!--                                <ng-container *ngIf="!user.blocked_at; else unlock">-->
                    <!--                                    <i class="fa fa-lock"-->
                    <!--                                       data-toggle="tooltip"-->
                    <!--                                       data-placement="top"-->
                    <!--                                       (click)="askBlockUser(user.id)"-->
                    <!--                                       title="{{'DISABLE ACCOUNT' | translate}}"></i>-->
                    <!--                                </ng-container>-->
                    <!--                                <ng-template #unlock>-->
                    <!--                                    <i class="fa fa-unlock"-->
                    <!--                                       data-toggle="tooltip"-->
                    <!--                                       data-placement="top"-->
                    <!--                                       (click)="askUnBlockUser(user.id)"-->
                    <!--                                       title="{{'ENABLE ACCOUNT' | translate}}"></i>-->
                    <!--                                </ng-template>-->
                    <!--                                <i class="fa fa-trash"-->
                    <!--                                   (click)="archive(user.id)"-->
                    <!--                                   data-toggle="tooltip"-->
                    <!--                                   data-placement="top"-->
                    <!--                                   title="{{'DELETE' | translate}}"></i>-->
                  </div>
                </td>
              </tr>
              </tbody>
            </table>
          </ng-container>
          <ng-container *ngSwitchCase="'sortie'">
            <table class="table-responsive card-list-table table_entree">
              <thead>
                <tr>
                <th>
                  Salarié
                </th>
                <th>
                  Matricule
                </th>
                <th>
                  Société
                </th>
                <th>
                  Siège
                </th>
                <th>
                  Date d'entrée
                </th>
                <th>
                  Centre de profit
                </th>
                <th>
                  Date de reception du courier
                </th>
                <th>
                  Motif
                </th>
                <th>
                  Fin normal préavis
                </th>
                <th>
                  Date limite de réponse
                </th>
                <th>
                  Date de sortie
                </th>
                <th>
                  Docs
                </th>
                <ng-container *ngFor="let extraColumn of getActiveColumns('columns_entree')">
                  <th>
                    {{extraColumn.label}}
                  </th>
              </ng-container>
<!--              <th style="text-align: center" [matTooltip]="'Selectionnez les colonnes que vous souhaitez visualiser'" class="sticky th-btn" width="2%" style="position: sticky;right:-80px;" [matMenuTriggerFor]="statusMenu">-->
<!--                <i class="fa fa-filter" ></i>-->
<!--              </th>-->
                <th  style="width:2%"  class="sticky">
                  <div style="text-align: center;position: sticky;right:-80px;" [matTooltip]="'Selectionnez les colonnes que vous souhaitez visualiser'" [matMenuTriggerFor]="statusMenu">
                    <i class="fa fa-filter primary-icon pointer" ></i><span class="link">Personnaliser</span>
                  </div>
                </th>
              <mat-menu #statusMenu="matMenu" [class]="'profile-menu'">
                <div mat-menu-item class="dropdown-item" *ngFor="let item of columns_entree" (click)="$event.stopPropagation()">
                  <div class="check-box-btn">
                    <input type="checkbox"
                           id="{{item.id}}"
                           [(ngModel)]="item.checked"
                           (change)="onCheckChange($event, item, statusMenu)"
                           name="{{item.id}}" >
                    <label for="{{item.id}}" >{{item.label}}</label>
                  </div>
                </div>
                <div mat-menu-item class="dropdown-item" (click)="$event.stopPropagation();">
                  <div class="check-box-btn" >
                    <input type="checkbox"
                           id="select_all"
                           [value]="'select_all'"
                           (change)="selectAllColumns()"
                           name="select_all" >
                    <label for="select_all" class="blue-text">Tout séléctionner</label>
                  </div>
                </div>
              </mat-menu>
              <mat-menu #placeholder="matMenu" class="placeholder"></mat-menu>

              </tr>
              </thead>
              <tbody>
                <tr *ngFor="let sortie of users" >
                  <td>
                    <ng-template #infopopover>
                      <div class="title">
                        {{sortie?.personal?.nom}} {{sortie?.personal?.prenom}}
                        <span class="light-text">{{sortie?.personal?.registration_number}}</span>
                      </div>
                      <div class="light-text">{{sortie.personal.prenom}}</div>
                      <div class="row">
                        <div class="col-12 info">
                          <div class="title">Date d'entrée</div>
                          <div class="value">
                            {{sortie?.personal?.entry_date | date:'dd/MM/yyyy'}}
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-12 info">
                          <div class="title">Date de sortie</div>
                          <div class="value">
                            {{sortie?.personal?.sortie_date | date:'dd/MM/yyyy'}}
                          </div>
                        </div>
                      </div>
                    </ng-template>

                    <div class="photo-cell pointer"
                         [routerLink]="['/users/details']"
                         [queryParams]="{step: 0, user_id: sortie.personal.id}"
                       [ngbPopover]="infopopover"
                        triggers="mouseenter:mouseleave"
                        placement="right"
                         container="body"
                         [autoClose]="true"
                    >
                      <div class="photo">
                        <div class="img-container">
                          <img
                            [attr.src]="sortie?.photo_profile ? (user.photo_profile |
                        getPhotoFromBackend: ('assets/images/'+(sortie?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png')) |
                        async) : ('assets/images/'+(sortie?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png'))"
                          />
                        </div>
                      </div>
                      <div class="name">
                        {{sortie?.personal?.nom || 'N.R'}}
                        {{sortie?.personal?.prenom || 'N.R'}}
                      </div>
                    </div>
                  </td>
                  <td data-title="Matricule" >
                    {{sortie?.personal?.registration_number || 'N.R'}}
                  </td>
                  <td data-title="Entité" >{{sortie?.personal?.entity_name || 'Piman Consultants'}}</td>
                  <td data-title="Entité" >{{sortie?.personal?.structure || 'Structure'}}</td>
                  <td data-title="Entité" >{{ (sortie?.personal?.entry_date | dateMessage) || 'N.R'}}</td>
                  <td data-title="Entité" >{{sortie?.personal?.manager_name || 'NSI'}}</td>
                  <td data-title="Entité" >{{ (sortie?.requested_at | dateMessage) || 'N.R'}}</td>
                  <td data-title="Entité" >{{sortie?.motif?.label || 'N.R'}}</td>
                  <td data-title="Entité" >{{ (sortie?.end_date_preavis | dateMessage: 'DD MMM yyyy HH:mm') || 'N.R'}}</td>
                  <td data-title="Entité" >{{ (sortie?.date_limite_reponse | dateMessage) || 'N.R'}}</td>
                  <td data-title="Entité" >{{ (sortie?.end_date | dateMessage) || 'N.R'}}</td>
                  <td data-title="Entité" >
                      <i class="icon-attachment primary-icon"></i>
                  </td>
                  <ng-container *ngFor="let extraColumn of getActiveColumns('columns_entree')">
                    <td>
                      <div class="check-box-btn"  [matTooltip]="sortie?.slug_actions[extraColumn.slug]?.user ? ('Validé par ' +sortie?.slug_actions?.[extraColumn.slug]?.user?.prenom + ' ' + sortie?.slug_actions?.[extraColumn.slug]?.user?.nom + ' le '+ (sortie?.slug_actions?.[extraColumn.slug]?.done_at | dateMessage)):''">
                        <input type="checkbox"
                               class="small-checkbox"
                               *ngIf="sortie.slug_actions[extraColumn.slug]"
                               [disabled]="sortie?.slug_actions?.[extraColumn.slug]?.checked"
                               [ngClass]="{'disabled': sortie?.slug_actions?.[extraColumn.slug]?.checked}"
                               id="with_inactive_cp"
                               (change)="markActionAsDone(sortie.slug_actions[extraColumn.slug].id,sortie.slug_actions[extraColumn.slug].checked)"
                               [checked]="sortie?.slug_actions?.[extraColumn.slug]?.checked"
                               [(ngModel)]="sortie.slug_actions[extraColumn.slug].checked"
                               name="checbox_" >
                      </div>
                    </td>
                </ng-container>
                  <td>
                    <div class="actions">
                      <i class="icon-edit primary-icon pointer" (click)="openSelectRole('sortie', sortie)"></i>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </ng-container>
          <ng-container *ngSwitchDefault>
            <ng-container *ngTemplateOutlet="emptyState"></ng-container>
          </ng-container>
        </ng-container>
      </div>
    </div>
    <div class="footer" *ngIf="users?.length>0">

      <app-pagination name="pagination"
                      (change)="changePagination()"
                      [(ngModel)]="pagination"
                      ngDefaultControl>
      </app-pagination>
      <!-- <div class="right-buttons flex-end">
        <app-button
          [text]="'Importer'"
          [type]="'tertiary_inverse'"
          [iconLeft]="'icon-file'"
          [customStyle]="{'white-space': 'nowrap'}"
        ></app-button>&nbsp;
        <app-button
          [text]="'Exporter'"
          [type]="'tertiary_inverse'"
          [iconLeft]="'icon-file'"
          [customStyle]="{'white-space': 'nowrap'}"
        ></app-button>
      </div> -->
    </div>
  </ng-container>
</div>

<ng-template #emptyState>
  <app-centred-message
    [image]="'images/user_empty_state.svg'"
    [message]="( 'Aucun utilisateur trouvé pour le moment' | translate )"
  ></app-centred-message>
</ng-template>

<ng-template #loadingTemplate>
  <div class="d-flex w-100 h-100 align-items-center justify-content-center">
    <img src="assets/images/loading.svg" style="height: 100px;" />
  </div>
</ng-template>
