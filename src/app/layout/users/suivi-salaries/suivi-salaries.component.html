<div class="list container top-container">
  <!--    <div class="foback-header">-->
  <!--&lt;!&ndash;      <app-button&ndash;&gt;-->
  <!--&lt;!&ndash;        [text]="'Retour'"&ndash;&gt;-->
  <!--&lt;!&ndash;        [type]="'tertiary'"&ndash;&gt;-->
  <!--&lt;!&ndash;        [iconLeft]="'icon-go-back'"&ndash;&gt;-->
  <!--&lt;!&ndash;      ></app-button>&ndash;&gt;-->
  <!--      <div class="right-buttons">-->
  <!--&lt;!&ndash;        <app-button&ndash;&gt;-->
  <!--&lt;!&ndash;          [text]="'Importer'"&ndash;&gt;-->
  <!--&lt;!&ndash;          [type]="'tertiary'"&ndash;&gt;-->
  <!--&lt;!&ndash;          [iconLeft]="'icon-file'"&ndash;&gt;-->
  <!--&lt;!&ndash;          [customStyle]="{'white-space': 'nowrap'}"&ndash;&gt;-->
  <!--&lt;!&ndash;        ></app-button>&nbsp;&ndash;&gt;-->
  <!--&lt;!&ndash;        <app-button&ndash;&gt;-->
  <!--&lt;!&ndash;          [text]="'Exporter'"&ndash;&gt;-->
  <!--&lt;!&ndash;          [type]="'tertiary'"&ndash;&gt;-->
  <!--&lt;!&ndash;          [iconLeft]="'icon-file'"&ndash;&gt;-->
  <!--&lt;!&ndash;          [customStyle]="{'white-space': 'nowrap'}"&ndash;&gt;-->
  <!--&lt;!&ndash;        ></app-button>&ndash;&gt;-->
  <!--        &nbsp;-->
  <!--        <app-button-->
  <!--          [text]="'Ajouter un utilisateur/collaborateur'"-->
  <!--          [type]="'primary'"-->
  <!--          [iconLeft]="'fa fa-plus'"-->
  <!--          (onClick)="openEditModal()"-->
  <!--          [customStyle]="{'white-space': 'nowrap'}"-->
  <!--        ></app-button>-->
  <!--      </div>-->
  <!--    </div>-->
      <div class="sub-header ">
        <h1 class="main-title">
         {{sectionName}}
        </h1>

        <div class="search d-flex">
          <div class="input-group">
            <input type="text"
                   class="form-control input"
                   placeholder="Rechercher un utilisateur"
                   (input)="getListElements()"
                   aria-describedby="basic-addon2"
                   [(ngModel)]="filter.keyword"/>
            <div class="input-group-append" id="basic-addon2">
              <i class="icon-search"></i>
            </div>
          </div>&nbsp;
          <app-button
            [text]="'Rechercher'"
            [type]="'primary_light'"
            [iconLeft]="'icon-search'"
            (onClick)="getListElements()"
            [customStyle]="{'white-space': 'nowrap'}"
          ></app-button>&nbsp;
          <app-button
            [text]="'Recherche avancé'"
            [iconRight]="showFilters ? 'icon-arrow-up': 'icon-arrow-down'"
            [type]="'tertiary'"
            (onClick)="showFilters = !showFilters; resetFilters()"
            [customStyle]="{'white-space': 'nowrap'}"
          ></app-button>
        </div>
        <div class="right-buttons">
          <app-button
            [text]="'Ajouter ' + type"
            [type]="'secondary'"
            [iconRight]="'icon-add'"
            (onClick)="openEditModal(type)"
            [customStyle]="{'white-space': 'nowrap'}"
          ></app-button>
        </div>
      </div>
    <div class="filter-container" *ngIf="showFilters">
      <h3 class="filter-tilte-bloc ">
        <span>Recherche avancée</span>
        <span class="reset-filters" (click)="resetFilters()">
            <i class="icon-close"></i>&nbsp;
            Réinitialiser les filtres
          </span>
      </h3>
      <div class="filtres row ">
        <div class="flex-column col-12 col-sm-6 col-lg-3  ">
          <label>Entité</label>
          <div>
            <ng-select class="select form-control"
                       [multiple]="true"
                       [items]="entities"
                       (change)="filterChanged()"
                       [(ngModel)]="filter.entities"
                       dropdownPosition="bottom"
                       [bindLabel]="'label'"
                       [bindValue]="'id'"
                       [placeholder]="'Filtrer par entité PIMAN'" ></ng-select>
          </div>
        </div>
        <div class=" flex-column  col-12 col-sm-6 col-lg-3 ">
          <label>Siège</label>
          <div>
            <ng-select class="select form-control"
                       [multiple]="true"
                       [items]="sieges"
                       [bindLabel]="'label'"
                       [bindValue]="'id'"
                       (change)="filterChanged()"
                       [(ngModel)]="filter.sieges"
                       [placeholder]="'Filtrer le siège'" ></ng-select>
          </div>
        </div>
        <div class=" flex-column  col-12 col-sm-6 col-lg-3 ">
          <label>Contrat</label>
          <div>
            <ng-select class="select form-control"
                       [multiple]="true"
                       [items]="contrats"
                       [bindLabel]="'label'"
                       [bindValue]="'id'"
                       (change)="filterChanged()"
                       [(ngModel)]="filter.contrats"
                       [placeholder]="'Filtrer contrat'"></ng-select>
          </div>
        </div>
        <div class=" flex-column  col-12 col-sm-6 col-lg-3 ">
          <label>Statut</label>
          <div>
            <ng-select class="select form-control"
                       [multiple]="true"
                       [items]="status"
                       [bindLabel]="'label'"
                       [bindValue]="'id'"
                       (change)="filterChanged()"
                       [(ngModel)]="filter.status"
                       [placeholder]="'Filtrer par statut'"></ng-select>
          </div>
        </div>
      </div>
      <div class="filtres row">
        <div class="flex-column col-12 col-sm-6">
          <label>Plage de visualisation</label>
          <div class="d-flex justify-content-between row">
            <div class="col">
              <div class="date-picker-group">
                <owl-date-time #owl_dt1 [pickerType]="'calendar'" ></owl-date-time>
                <input [owlDateTime]="owl_dt1"
                       class="form-control input date"
                       [owlDateTimeTrigger]="owl_dt1"
                       placeholder="Choisir la date de début"
                       [(ngModel)]="filter.startDate"
                />
                <div class="icons-container">
                  <i class="icon-close"
                     (click)="filter.startDate = null"
                     *ngIf="filter.startDate"></i>&nbsp;
                  <i [owlDateTimeTrigger]="owl_dt1" class="fa fa-calendar"></i>
                </div>
              </div>
            </div>
            <div class="col">
              <div class="date-picker-group">
                <owl-date-time #owl_dt2 [pickerType]="'calendar'" ></owl-date-time>
                <input [owlDateTime]="owl_dt2"
                       class="form-control input date"
                       [owlDateTimeTrigger]="owl_dt2"
                       placeholder="Choisir la date de fin"
                       [(ngModel)]="filter.endDate"
                />
                <div class="icons-container">
                  <i class="icon-close"
                     (click)="filter.endDate = null"
                     *ngIf="filter.endDate"></i>&nbsp;
                  <i [owlDateTimeTrigger]="owl_dt2" class="fa fa-calendar"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="flex-column col-12 col-sm-6 col-lg-3 " *ngIf="_allActions && _allActions.length > 0">
          <label>Actions effectuées</label>
          <div>
            <ng-select class="select form-control"
                       [multiple]="true"
                       [items]="_allActions"
                       (change)="filterChanged()"
                       [(ngModel)]="filter.actions_valid"
                       [bindLabel]="'label'"
                       [bindValue]="'id'"
                       groupBy="model_type"
                       [selectableGroup]="true"
                       [selectableGroupAsModel]="false"
                       [closeOnSelect]="false"
                       [placeholder]="'Filtrer par actions validées'" >
                       <ng-template ng-optgroup-tmp let-item="item" let-item$="item$" let-index="index">
                          <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected"/>
                          <span class="txt">
                            {{ "Tout sélectionner" | uppercase}}
                          </span>
                      </ng-template>
                      <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                          <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected"/>
                          <span style="top: -2px;
                          position: relative;">

                            {{item.label}}
                          </span>
                    </ng-template>
            </ng-select>
          </div>
        </div>
        <div class=" flex-column  col-12 col-sm-6 col-lg-3 " *ngIf="_allActions && _allActions.length > 0">
          <label>Actions non effectuées</label>
          <div>
                       <ng-select class="select form-control"
                       [multiple]="true"
                       [items]="_allActions"
                       (change)="filterChanged()"
                       [(ngModel)]="filter.actions_to_valid"
                       [bindLabel]="'label'"
                       [bindValue]="'id'"
                       groupBy="model_type"
                       [selectableGroup]="true"
                       [selectableGroupAsModel]="false"
                       [closeOnSelect]="false"
                       [placeholder]="'Filtrer par actions non validées'" >
                       <ng-template ng-optgroup-tmp let-item="item" let-item$="item$" let-index="index">
                          <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected"/>
                          <span class="txt">
                            {{ "Tout sélectionner" | uppercase}}
                          </span>
                      </ng-template>
                      <ng-template ng-option-tmp let-item="item" let-item$="item$" let-index="index">
                          <input id="item-{{index}}" type="checkbox" [ngModel]="item$.selected"/>
                          <span style="top: -2px;
                          position: relative;">

                            {{item.label}}
                          </span>
                    </ng-template>
            </ng-select>
          </div>
        </div>
      </div>

      <div class="filtres row ">
        <div class="flex-column col-12 col-sm-6 col-lg-3 " *ngIf="type =='period_essai'">
          <label>Décision PE</label>
          <div>
               <ng-select
                [items]="decisions"
                [bindLabel]="'label'"
                [bindValue]="'id'"
                (change)="filterChanged()"
                (open)="getFilterList('decisions','status','decision_trail_period')"
                class="form-control select"
                placeholder="Sélectionner la décision"
                [(ngModel)]="filter.decisions"
                [multiple]="true">
              </ng-select>
          </div>
        </div>
        <div class=" flex-column  col-12 col-sm-6 col-lg-3 " *ngIf="type =='visite_medicale'">
          <label>Centre médical</label>
          <div>
            <input id="typeahead-basic"
            type="text"
            class="form-control input"
            (change)="filterChanged()"
            [(ngModel)]="filter.centre"
            placeholder="Saisir le centre médical"
            [ngbTypeahead]="medical_center_search"  />
            <label class="light-text" *ngIf="searching">Recherche...</label>
          </div>
        </div>
        <div class=" flex-column  col-12 col-sm-6 col-lg-3 " *ngIf="type === 'entretien'">
          <label>Type</label>
          <div>
            <ng-select
              [items]="entretien_types"
              [bindLabel]="'label'"
              [bindValue]="'id'"
              (change)="filterChanged()"
              class="form-control select"
              placeholder="Sélectionner le type d'entretien"
              [(ngModel)]="filter.types"
              (open)="getFilterList('entretien_types', listService.list.INTERVIEW_TYPE)"
              [loading]="loadingSelect[listService.list.INTERVIEW_TYPE]"
              [multiple]="true">
            </ng-select>
          </div>
        </div>
        <div class="flex-column col-12 col-sm-6 col-lg-3  ">
          <label>Business Manager</label>
          <div>
            <ng-select class="select form-control"
                       [multiple]="true"
                       [items]="personals"
                       (change)="filterChanged()"
                       [(ngModel)]="filter.managers"
                       [bindLabel]="'full_name'"
                       [bindValue]="'id'"
                       [placeholder]="'Filtrer par salarié'" ></ng-select>
          </div>
        </div>
      </div>
      <!-- <div class="filtres row">
        <div class="flex-column  col-12 col-sm-6 col-lg-3  block-check ">
          <label class="">Etat de l'utilisateur</label>
          <div class="btn-group btn-group-toggle"
               ngbRadioGroup name="radioBasic"
               (change)="filterChanged()"
               [(ngModel)]="filter.user_stats">
            <label ngbButtonLabel
                   [ngClass]="{'btn-primary': filter.user_stats === true}">
              <input ngbButton type="radio" [value]="true"> Actif
            </label>
            <label ngbButtonLabel class="btn-primary"
                   [ngClass]="{'btn-primary': filter.user_stats === null}">
              <input ngbButton type="radio" [value]="null"> Tous
            </label>
            <label ngbButtonLabel
                   [ngClass]="{'btn-primary': filter.user_stats === false}">
              <input ngbButton type="radio" [value]="false"> Inactif
            </label>
          </div>
        </div>
        <div class="flex-column  col-12 col-sm-6 col-lg-3  block-check ">
          <label class="">Utilisateur virtuel</label>
          <div class="btn-group btn-group-toggle"
               ngbRadioGroup name="radioBasic"
               (change)="filterChanged()"
               [(ngModel)]="filter.is_virtual">
            <label ngbButtonLabel
                   [ngClass]="{'btn-primary': filter.is_virtual === true}">
              <input ngbButton type="radio" [value]="true"> Oui
            </label>
            <label ngbButtonLabel class="btn-primary"
                   [ngClass]="{'btn-primary': filter.is_virtual === null}">
              <input ngbButton type="radio" [value]="null"> Tous
            </label>
            <label ngbButtonLabel
                   [ngClass]="{'btn-primary': filter.is_virtual === false}">
              <input ngbButton type="radio" [value]="false"> Non
            </label>
          </div>
        </div>
      </div> -->
    </div>
      <div class="sub-header" *ngIf="showFilters || keyword?.length>0">
        <h2 class="main-title">
          Résultats de recherche
        </h2>
      </div>
    <ng-container *ngIf="!loadingData; else loadingTemplate">
      <div class="wrap" *ngIf="listItems?.length>0; else emptyState" >
        <div class="table-wrapper">
          <ng-container [ngSwitch]="type">
            <ng-container *ngSwitchCase="'general'">
              <table class="table-responsive card-list-table">
                <thead>
                  <tr>
                  <th>
                    Matricule
                  </th>
                  <th>
                    Salarié
                  </th>
                  <th>
                    Profil
                  </th>
                  <th>
                    Rôle
                  </th>
                  <th>
                    Centre de profit
                  </th>
                  <th>
                    Appartenance
                  </th>
                  <th>
                    Entrée
                  </th>
                  <th>
                    Sortie
                  </th>
                  <th>
                    Téléphone
                  </th>
                  <th>
                    Email
                  </th>
                  <th>
                    Dernière connexion
                  </th>
                  <th style="text-align: right;">Action</th>
                </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of listItems"  >
                    <td data-title="Numéro de registration" >{{item?.registration_number}}</td>
                    <td>
                      <div class="photo-cell pointer" [routerLink]="['/users/details/'+item.id]">
                        <div class="photo">
                          <div class="img-container">
                            <img
                              [attr.src]="item?.photo_profile ? (item.photo_profile |
                          getPhotoFromBackend: ('assets/images/'+(item?.civility === 'Mme' ? 'woman.png': 'man.png')) |
                          async) : ('assets/images/'+(item?.civility === 'Mme' ? 'woman.png': 'man.png'))"
                            />
                          </div>
                        </div>
                        <div class="name">{{item?.full_name}} </div>
                      </div>
                    </td>
                    <td data-title="Profile" >{{item?.profile_name}}</td>
                    <td data-title="Rôle" >{{item?.role_name}}</td>
                    <td data-title="Ceentre de profit"  >{{item?.cp_name}}</td>
                    <td data-title="Appartenance" >{{item?.member_ship_name}}</td>
                    <td data-title="Entrée"  >{{item?.entry_date | dateMessage}}</td>
                    <td data-title="Sortie"  >{{item?.end_date | dateMessage}}</td>
                    <td data-title="Telephone portable">{{item?.telephone_portable}}</td>
                    <td data-title="Email">{{item?.email}}</td>
                    <td>{{item?.last_login | timeAgo}} </td>
                    <td style="text-align: right;padding-right: 0;">
                      <div class="actions">
                        <i class="icon-eye"
                           data-toggle="tooltip"
                           data-placement="top"
                           (click)="goToUpdateUser(item)"
                           title="Détails"></i>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </ng-container>
            <ng-container *ngSwitchCase="'period_essai'">
              <table class="table-responsive card-list-table">
                <thead>
                 <tr>
                   <th>
                     Matricule
                    </th>
                    <th>
                      Salarié
                    </th>
                   <th>
                     Centre de profit
                   </th>
                  <th>
                    Statut salarié
                  </th>
                  <th>
                    Date entrée
                  </th>
                  <!-- <th>
                    Ancienneté
                  </th> -->
                  <th>
                    Décision
                  </th>
                  <th>
                    Date de fin de renouvellement
                  </th>
                  <!-- <th>
                    Suivi evolution période d'essai
                  </th> -->
                  <th>
                    Date fin période essai
                  </th>
                  <th>
                    Date sortie
                  </th>
                  <th *ngFor="let action of _allActions">
                    {{action.label}}
                  </th>
                  <!-- <th>
                    Courrier P.E signé
                  </th>
                   <th>
                    Réception bilan PE
                  </th> -->
                 </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of listItems"  >
                    <td data-title="Numéro de registration" >{{item?.personal?.registration_number}}</td>
                      <ng-template #infopopover>
                      <div class="title">
                        {{item?.personal?.nom}} {{item?.personal?.prenom}}
                        <span class="light-text" *ngIf="item?.personal?.registration_number">({{item?.personal?.registration_number}})</span>
                      </div>
                      <table class="small-table">
                        <tr>
                          <td>
                            <div class="label blue-text" >Date d'entrée</div>
                          </td>
                          <td>
                            <div class="value" >{{ item?.personal?.entry_date | dateMessage}}</div>
                          </td>
                        </tr>
                        <tr *ngIf="item?.personal?.entity">
                          <td>
                            <div class="label blue-text" >Société</div>
                          </td>
                          <td>
                            <div class="value" >{{item?.personal?.entity?.label}}</div>
                          </td>
                        </tr>
                        <tr>
                          <td>
                            <div class="label blue-text" >Centre de profit</div>
                          </td>
                          <td>
                            <div class="value" >{{item?.personal?.manager?.full_name}}</div>
                          </td>
                        </tr>
                      </table>
                      <ng-container
                          *ngIf="item?.personal?.has_interview_to_validate ||  item?.personal?.has_medical_visit_to_validate || item?.personal?.has_trial_period_to_validate">
                          <div class="item danger-text text-decoration-underline">Informations manquantes</div>
                          <table class="small-table">
                            <tr *ngIf="item?.personal?.has_trial_period_to_validate">
                              <td>
                                <div class="item danger-text">
                                  Période d'essai à valider &nbsp;&nbsp;
                                  <a
                                    target="_blank"
                                    [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.periode_essai]"
                                  >
                                    <i class="fa fa-external-link danger-icon"></i>
                                  </a>
                                </div>
                              </td>
                            </tr>
                            <tr *ngIf="item?.personal?.has_interview_to_validate">
                              <td>
                                <div class="item danger-text">
                                  Entretien à effectuer &nbsp;&nbsp;
                                  <a
                                    target="_blank"
                                    [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.entretien]"
                                  >
                                    <i class="fa fa-external-link danger-icon"></i>
                                  </a>
                                </div>
                              </td>
                            </tr>
                            <tr *ngIf="item?.personal?.has_medical_visit_to_validate">
                              <td>
                                <div class="item danger-text" >
                                  Visites médicales à valider &nbsp;&nbsp;
                                  <a
                                    target="_blank"
                                    [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.visite_medicale]"
                                  >
                                    <i class="fa fa-external-link danger-icon"></i>
                                  </a>
                                </div>
                              </td>
                            </tr>
                          </table>
                        </ng-container>
                    </ng-template>
                    <td>
                      <div class="photo-cell pointer">
                        <div class="photo">
                          <div class="img-container">
                            <img
                              [ngbPopover]="infopopover"
                              placement="right"
                              container="body"
                              [autoClose]="true"
                              [attr.src]="item?.personal?.photo_profile ? (item?.personal?.photo_profile |
                            getPhotoFromBackend: ('assets/images/'+(item?.personal?.civility === 'Mme' ? 'woman.png': 'man.png')) |
                            async) : ('assets/images/'+(item?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png'))"
                            />
                            <i class="fa fa-exclamation-triangle danger-icon"
                               *ngIf="item?.personal?.has_interview_to_validate ||  item?.personal?.has_medical_visit_to_validate || item?.personal?.has_trial_period_to_validate"
                            ></i>
                          </div>
                        </div>
                        <div class="name"
                             [routerLink]="['/users/details']" [queryParams]="{step: STEPS.periode_essai, user_id: item.personal_id}"
                        >{{item?.personal?.nom}} {{item?.personal?.prenom}} </div>
                      </div>
                    </td>
                    <td data-title="Centre de profit" class="tel">{{ item?.entrance?.manager?.full_name || 'of perso ::'+ item?.personal?.manager?.full_name}}</td>
                    <td data-title="Rôle" >{{item?.entrance?.status?.label || 'of perso::'+item?.personal?.status?.label || 'status_personal'}}</td>
                    <td data-title="Entrée" class="tel">{{ (item?.entrance?.entry_date | dateMessage)  ||(item?.personal?.entry_date | dateMessage) || 'N.R'}}</td>
                    <td data-title="Numéro de registration" >{{item?.decision?.label || 'En attente' }}</td>
                    <td data-title="Sortie" class="tel">{{(item?.renewal_date | dateMessage) || 'N.R'}}</td>
                    <td data-title="Sortie" class="tel">{{(item?.end_date | dateMessage) || 'N.R'}}</td>
                    <td data-title="Sortie" class="tel">{{(item?.personal?.end_date | dateMessage) || 'N.R'}}</td>
                    <ng-container *ngFor="let histo of item?.historiques_actions">
                      <td>
                        <div class="check-box-btn"  [matTooltip]="histo?.user ? ('Validé par ' +histo?.user?.prenom + ' ' + histo?.user?.nom + ' le '+ (histo?.done_at | dateMessage)):''">
                          <input type="checkbox"
                                 class="small-checkbox"
                                 [disabled]="histo?.checked"
                                 [ngClass]="{'disabled': histo?.checked}"
                                 id="with_inactive_cp"
                                 (change)="markActionAsDone(histo.id, histo.checked)"
                                 [checked]="histo?.checked"
                                 [(ngModel)]="histo.checked"
                                 name="checbox_" >
                        </div>
                      </td>
                  </ng-container>
                  </tr>
                </tbody>
              </table>
            </ng-container>
            <ng-container *ngSwitchCase="'entretien'">
              <table class="table-responsive card-list-table">
                <thead>
                   <tr>
                     <th>Salarié</th>
                      <th>Matricule</th>
                      <th>Société</th>
                      <th>Date entrée</th>
                      <th>Centre de profit</th>
                      <th>Type entretien</th>
                      <th>Date théorique</th>
                      <th>Date effective</th>
                      <th>Etat</th>
                      <th>Pièces jointes</th>
                      <th style="text-align: right">Actions</th>
                    </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of listItems"  >
                    <ng-template #infopopover>
                      <div class="title">
                        {{item?.personal?.nom}} {{item?.personal?.prenom}}
                        <span class="light-text">({{item?.personal?.registration_number}})</span>
                      </div>
                      <table class="small-table">
                        <tr>
                          <td>
                            <div class="label blue-text" >Date d'entrée</div>
                          </td>
                          <td>
                            <div class="value" >{{item?.personal?.entry_date | dateMessage}}</div>
                          </td>
                        </tr>
                        <tr>
                          <td>
                            <div class="label blue-text" >Société</div>
                          </td>
                          <td>
                            <div class="value" >{{item?.personal?.entity?.label}}</div>
                          </td>
                        </tr>
                        <tr>
                          <td>
                            <div class="label blue-text" >Centre de profit</div>
                          </td>
                          <td>
                            <div class="value" >{{item?.personal?.manager?.full_name}}</div>
                          </td>
                        </tr>
                      </table>
                      <ng-container
                          *ngIf="item?.personal?.has_interview_to_validate || item?.personal?.has_medical_visit_to_validate || item?.personal?.has_trial_period_to_validate"
                        >
                          <div class="item danger-text text-decoration-underline">Informations manquantes</div>
                          <table class="small-table">
                            <tr *ngIf="item?.personal?.has_trial_period_to_validate">
                              <td>
                                <div class="item danger-text">
                                  Période d'essai à valider &nbsp;&nbsp;
                                  <a
                                    target="_blank"
                                    [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.periode_essai]"
                                  >
                                    <i class="fa fa-external-link danger-icon"></i>
                                  </a>
                                </div>
                              </td>
                            </tr>
                            <tr *ngIf="item?.personal?.has_interview_to_validate">
                              <td>
                                <div class="item danger-text">
                                  Entretien à effectuer &nbsp;&nbsp;
                                  <a
                                    target="_blank"
                                    [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.entretien]"
                                  >
                                    <i class="fa fa-external-link danger-icon"></i>
                                  </a>
                                </div>
                              </td>
                            </tr>
                            <tr *ngIf="item?.personal?.has_medical_visit_to_validate">
                              <td>
                                <div class="item danger-text" >
                                  Visites médicales à valider &nbsp;&nbsp;
                                  <a
                                    target="_blank"
                                    [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.visite_medicale]"
                                  >
                                    <i class="fa fa-external-link danger-icon"></i>
                                  </a>
                                </div>
                              </td>
                            </tr>
                          </table>
                        </ng-container>
                    </ng-template>
                    <td>
                      <div class="photo-cell pointer">
                        <div class="photo">
                          <div class="img-container">
                            <img
                              [ngbPopover]="infopopover"
                              placement="right"
                              container="body"
                              [autoClose]="true"
                              [attr.src]="item?.photo_profile ? (item?.personal?.photo_profile |
                            getPhotoFromBackend: ('assets/images/'+(item?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png')) |
                            async) : ('assets/images/'+(item?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png'))"
                            />
                            <i class="fa fa-exclamation-triangle danger-icon"
                               *ngIf="item?.personal?.has_interview_to_validate || item?.personal?.has_medical_visit_to_validate || item?.personal?.has_trial_period_to_validate">
                              ></i>
                          </div>
                        </div>
                        <div class="name"
                             [routerLink]="['/users/details']" [queryParams]="{step: STEPS.entretien, user_id: item?.personal_id}"
                        >{{item?.personal?.nom}} {{item?.personal?.prenom}} </div>
                      </div>
                    </td>
                    <td>{{item?.personal?.registration_number}}</td>
                    <td>{{item?.personal?.entity?.label || 'entity_name'}}</td>
                    <td>{{ (item?.personal?.entry_date | dateMessage )|| 'date entree'}}</td>
                    <td>{{item?.personal?.manager?.full_name}}</td>
                    <td>{{item?.type?.label || 'entretien_type'}}</td>
                    <td>
                      {{item?.theoretical_date | dateMessage}}
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <owl-date-time #owl_dt1 [pickerType]="'calendar'"
                        ></owl-date-time>
                        <input [owlDateTime]="owl_dt1"
                               class="form-control input date"
                               [owlDateTimeTrigger]="owl_dt1"
                               [placeholder]="'Sélectionner une date'"
                               [(ngModel)]="item.effective_date"
                               style="width: 0;margin: 0; padding: 0;visibility: hidden"
                               #effective_date_input
                               (ngModelChange)="updateDateInterview(item.id, item.effective_date)"
                        />
                        <span class="pointer" [ngClass]="{'link': !item?.effective_date}" (click)="effective_date_input.click()">
                           <i class="fa fa-calendar primary-icon"></i>&nbsp; {{item?.effective_date ? (item?.effective_date | dateMessage): 'Ajouter une date'}}
                          </span>
                      </div>
                    </td>
                    <td>{{item.effective_date ? 'Réalisé':'Planifiée' || 'etat'}}</td>
                    <td >
                      <!-- <span class="link">Attacher un document</span> &nbsp; -->
                      <span class="pointer" *ngIf="item?.document_files?.attachments?.length" (click)="openDocumentRHFilesModal(item?.document_files)">
                        <i class="icon-attachment"></i>
                        {{item?.document_files?.attachments?.length || 0}}
                      </span>
                    </td>
                    <td style="padding-right: 0;">
                      <div class="actions">
                        <i class="icon-edit"
                           data-toggle="tooltip"
                           data-placement="top"
                           (click)="openEditModal('entretien', item)"
                           title="Modifier"></i>&nbsp;&nbsp;
                        <i class="icon-close danger-icon"
                           data-toggle="tooltip"
                           data-placement="top"
                           title="Supprimer"></i>
                      </div>
                    </td>
                </tr>
                </tbody>
              </table>
            </ng-container>
            <ng-container *ngSwitchCase="'formation'">
              <table class="table-responsive card-list-table">
                <thead>
                  <tr>
                    <th>Nom</th>
                    <th>Matricule</th>
                    <th>Profil</th>
                    <th>Centre de profit</th>
                    <th>Email</th>
                    <th>Tel</th>
                    <th class="icon-cell"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of listItems"  >
                  <td>
                    <ng-template #infopopover>
                      <div class="title">
                        {{item?.personal?.nom}} {{item?.personal?.prenom}}
                        <span class="light-text">({{item?.personal?.registration_number}})</span>
                      </div>
                      <table class="small-table">
                        <tr>
                          <td>
                            <div class="label blue-text" >Date d'entrée</div>
                          </td>
                          <td>
                            <div class="value" >{{item?.personal?.entry_date | dateMessage}}</div>
                          </td>
                        </tr>
                        <tr>
                          <td>
                            <div class="label blue-text" >Société</div>
                          </td>
                          <td>
                            <div class="value" >{{item?.personal?.entity}}</div>
                          </td>
                        </tr>
                        <tr>
                          <td>
                            <div class="label blue-text" >Centre de profit</div>
                          </td>
                          <td>
                            <div class="value" >{{item?.personal?.manager}}</div>
                          </td>
                        </tr>
                      </table>
                      <ng-container
                          *ngIf="item?.personal?.has_interview_to_validate || item?.personal?.has_medical_visit_to_validate || item?.personal?.has_trial_period_to_validate" >
                          <div class="item danger-text text-decoration-underline">Informations manquantes</div>
                          <table class="small-table">
                            <tr *ngIf="item?.personal?.has_trial_period_to_validate">
                              <td>
                                <div class="item danger-text">
                                  Période d'essai à valider &nbsp;&nbsp;
                                  <a
                                    target="_blank"
                                    [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.periode_essai]"
                                  >
                                    <i class="fa fa-external-link danger-icon"></i>
                                  </a>
                                </div>
                              </td>
                            </tr>
                            <tr *ngIf="item?.personal?.has_interview_to_validate">
                              <td>
                                <div class="item danger-text">
                                  Entretien à effectuer &nbsp;&nbsp;
                                  <a
                                    target="_blank"
                                    [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.entretien]"
                                  >
                                    <i class="fa fa-external-link danger-icon"></i>
                                  </a>
                                </div>
                              </td>
                            </tr>
                            <tr *ngIf="item?.personal?.has_medical_visit_to_validate">
                              <td>
                                <div class="item danger-text" >
                                  Visites médicales à valider &nbsp;&nbsp;
                                  <a
                                    target="_blank"
                                    [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.visite_medicale]"
                                  >
                                    <i class="fa fa-external-link danger-icon"></i>
                                  </a>
                                </div>
                              </td>
                            </tr>
                          </table>
                        </ng-container>
                    </ng-template>

                    <div class="photo-cell pointer">
                      <div class="photo">
                        <div class="img-container">
                          <img
                            [ngbPopover]="infopopover"
                            placement="right"
                            container="body"
                            [autoClose]="true"
                            [attr.src]="item?.personal?.photo_profile ? (item?.personal?.photo_profile |
                        getPhotoFromBackend: ('assets/images/'+(item?.personal?.civility === 'Mme' ? 'woman.png': 'man.png')) |
                        async) : ('assets/images/'+(item?.personal?.civility === 'Mme' ? 'woman.png': 'man.png'))"
                          />
                        </div>
                      </div>
                      <div class="name"
                           [routerLink]="['/users/details']" [queryParams]="{step: STEPS.formation, user_id: item?.personal_id}"
                      >{{item?.personal?.nom}} {{item?.personal?.prenom}}</div>
                    </div>
                  </td>
                  <td>{{item?.registration_number}}</td>
                  <td data-title="Email" >{{item?.profile_name}}</td>
                  <td data-title="Téléphonne" class="tel">{{item?.cp_name}}</td>
                  <td data-title="Profil">{{item?.email_professional}}</td>
                  <td data-title="Centre d'interêt">{{item?.telephone_professional}}</td>
                  <td >
                    <div class="actions">
                      <i class="icon-eye"
                         data-toggle="tooltip"
                         data-placement="top"
                         (click)="goToUpdateUser(item)"
                         title="Détails"></i>
                    </div>
                  </td>
                </tr>
                </tbody>
              </table>
            </ng-container>
            <ng-container *ngSwitchCase="'visite_medicale'">
              <table class="table-responsive card-list-table">
                <thead>
                <tr>
                  <th>
                    Salarié
                  </th>
                  <th>
                    Matricule
                  </th>
                  <th>
                    Société
                  </th>
                  <th>
                    Siège
                  </th>
                  <th>
                    Centre médical
                  </th>
                  <!-- <th>
                    Date dernière visite médicale
                  </th> -->
                  <th>
                    Date visite médicale
                  </th>
                  <th>
                    Convocation envoyée
                  </th>
                  <th>Pièces jointes</th>
                  <th style="text-align: right">Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let item of listItems"  >
                  <td>
                    <ng-template #infopopover>
                      <div class="title">
                        {{item?.personal?.nom}} {{item?.personal?.prenom}}
                        <span class="light-text">({{item?.personal?.registration_number}})</span>
                      </div>
                      <table class="small-table">
                        <tr>
                          <td>
                            <div class="label blue-text" >Date d'entrée</div>
                          </td>
                          <td>
                            <div class="value" >{{item?.personal?.entry_date | dateMessage}}</div>
                          </td>
                        </tr>
                        <tr>
                          <td>
                            <div class="label blue-text" >Société</div>
                          </td>
                          <td>
                            <div class="value" >{{item?.personal?.entity?.label}}</div>
                          </td>
                        </tr>
                        <tr>
                          <td>
                            <div class="label blue-text" >Centre de profit</div>
                          </td>
                          <td>
                            <div class="value" >{{item?.personal?.manager?.full_name}}</div>
                          </td>
                        </tr>
                      </table>
                      <ng-container
                        *ngIf="item?.personal?.has_interview_to_validate || item?.personal?.has_medical_visit_to_validate ||  item?.personal?.has_trial_period_to_validate"
                      >
                        <div class="item danger-text text-decoration-underline">Informations manquantes</div>
                        <table class="small-table">
                          <tr *ngIf="item?.personal?.has_trial_period_to_validate">
                            <td>
                              <div class="item danger-text">
                                Période d'essai à valider &nbsp;&nbsp;
                                <a
                                  target="_blank"
                                  [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.periode_essai]"
                                >
                                  <i class="fa fa-external-link danger-icon"></i>
                                </a>
                              </div>
                            </td>
                          </tr>
                          <tr *ngIf="item?.personal?.has_interview_to_validate">
                            <td>
                              <div class="item danger-text">
                                Entretien à effectuer &nbsp;&nbsp;
                                <a
                                  target="_blank"
                                  [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.entretien]"
                                >
                                  <i class="fa fa-external-link danger-icon"></i>
                                </a>
                              </div>
                            </td>
                          </tr>
                          <tr *ngIf="item?.personal?.has_medical_visit_to_validate">
                            <td>
                              <div class="item danger-text" >
                                Visites médicales à valider &nbsp;&nbsp;
                                <a
                                  target="_blank"
                                  [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.visite_medicale]"
                                >
                                  <i class="fa fa-external-link danger-icon"></i>
                                </a>
                              </div>
                            </td>
                          </tr>
                        </table>
                      </ng-container>
                    </ng-template>

                    <div class="photo-cell pointer">
                      <div class="photo">
                        <div class="img-container">
                          <img
                            [ngbPopover]="infopopover"
                            placement="right"
                            container="body"
                            [autoClose]="false"
                            [attr.src]="item?.personal?.photo_profile ? (item?.personal?.photo_profile |
                        getPhotoFromBackend: ('assets/images/'+(item?.personal?.civility === 'Mme' ? 'woman.png': 'man.png')) |
                        async) : ('assets/images/'+(item?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png'))"
                          />
                          <i class="fa fa-exclamation-triangle danger-icon"
                             *ngIf="item?.personal?.has_interview_to_validate || item?.personal?.has_medical_visit_to_validate || item?.personal?.has_trial_period_to_validate">
                            ></i>
                        </div>
                      </div>
                      <div class="name"
                           [routerLink]="['/users/details']" [queryParams]="{step: STEPS.visite_medicale, user_id: item?.personal_id}"
                      >{{item?.personal?.nom}} {{item?.personal?.prenom}}</div>
                    </div>
                  </td>
                  <td>{{item?.personal?.registration_number}}</td>
                  <td>{{item?.personal?.entity?.label || 'N.R'}}</td>
                  <td>{{item?.personal?.siege?.label || 'N.R'}}</td>
                  <td>
                    <ng-container *ngIf="item.is_editting_mc; else mc_label_temp">
                      <div class="d-flex align-items-center">
                        <input id="typeahead-basic"
                               type="text"
                               class="form-control input"
                               [placeholder]="'Saisir le nom du centre médical'"
                               [(ngModel)]="item.tmp_medical_centre"
                               [ngbTypeahead]="medical_center_search"
                        />
                        <div class="text-center d-flex text-nowrap">
                          &nbsp;&nbsp;<i class="icon-check primary-icon pointer" (click)="updateVM('centre', item.id, item.tmp_medical_centre)"></i>
                          &nbsp;&nbsp;<i class="icon-close danger-icon pointer" (click)="item.is_editting_mc = false"></i>
                        </div>
                      </div>
                    </ng-container>
                    <ng-template #mc_label_temp>
                      {{item?.centre || 'Ajouter un centre médical'}}
                      &nbsp;<i class="icon-edit-bold primary-icon pointer" (click)="openVmForEditting('centre', item)"></i>
                    </ng-template>
                  </td>
                  <!-- <td>
                    <span>
                      {{item?.personal?.last_vm?.scheduled_date | dateMessage}}
                    </span>
                  </td> -->
                  <td>
                    <div class="d-flex align-items-center">
                      <owl-date-time #owl_dt2 [pickerType]="'calendar'"
                      ></owl-date-time>
                      <input [owlDateTime]="owl_dt2"
                             class="form-control input date"
                             [owlDateTimeTrigger]="owl_dt2"
                             [placeholder]="'Sélectionner une date'"
                             [(ngModel)]="item.scheduled_date"
                             style="width: 0;margin: 0; padding: 0;visibility: hidden"
                             #scheduled_date_input
                             (ngModelChange)="updateVM('scheduled_date', item.id, item.scheduled_date)"
                      />
                      <span class="pointer" [ngClass]="{'link': !item?.scheduled_date}" (click)="scheduled_date_input.click()">
                           <i class="fa fa-calendar primary-icon"></i>&nbsp; {{item?.scheduled_date ? (item?.scheduled_date | dateMessage): 'Ajouter une date'}}
                          </span>
                    </div>
                  </td>

                    <td>
                      <ng-container *ngFor="let histo of item?.historiques_actions">
                        <div class="check-box-btn"  [matTooltip]="histo?.user ? ('Validé par ' +histo?.user?.prenom + ' ' + histo?.user?.nom + ' le '+ (histo?.done_at | dateMessage)):''">
                        <input type="checkbox"
                               class="small-checkbox"
                               [disabled]="histo?.checked"
                               [ngClass]="{'disabled': histo?.checked}"
                               id="with_inactive_cp"
                               (change)="markActionAsDone(histo.id, histo.checked)"
                               [checked]="histo?.checked"
                               [(ngModel)]="histo.checked"
                               name="checbox_" >
                      </div>
                      </ng-container>
                    </td>

                  <td>
                    <span class="pointer" *ngIf="item?.document_files?.attachments?.length" (click)="openDocumentRHFilesModal(item?.document_files)">
                      <i class="icon-attachment"></i>
                      {{item?.document_files?.attachments?.length || 0}}
                    </span>
                  </td>
                  <td>
                    <div class="actions">
                      <i class="icon-edit"
                         data-toggle="tooltip"
                         data-placement="top"
                         (click)="openEditModal('visite_medicale', item)"
                         title="Modifier"></i>
                    </div>
                  </td>
                </tr>
                </tbody>
              </table>
            </ng-container>
            <ng-container *ngSwitchCase="'entree'">
              <table class="table-responsive card-list-table table_entree">
                <thead>
                  <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <ng-container *ngFor="let extraColumn of getActiveColumns('columns_entree')">
                      <th>
                      </th>
                    </ng-container>
                  </tr>
                  <tr>
                    <th>
                      Matricule
                    </th>
                    <th>
                      Salarié
                    </th>
                    <th>
                      Société
                    </th>
                    <th>
                      Siège
                    </th>
                    <th>
                      Date d'entrée
                    </th>
                    <th>
                      Centre de profit
                    </th>
                    <th>
                      Type de contrat
                    </th>
                    <th>
                      Statut
                    </th>
                    <ng-container *ngFor="let extraColumn of getActiveColumns('columns_entree')">
                        <th>
                          {{extraColumn.label}}
                        </th>
                    </ng-container>
                    <th style="text-align: center" [matTooltip]="'Selectionnez les colonnes que vous souhaitez visualiser'" class="sticky th-btn" width="2%" style="position: sticky;right:-80px;" [matMenuTriggerFor]="statusMenu">
                      <i class="fa fa-filter" ></i>
                    </th>
                    <mat-menu #statusMenu="matMenu" [class]="'profile-menu'">
                      <div mat-menu-item class="dropdown-item" *ngFor="let item of columns_entree" (click)="$event.stopPropagation()">
                        <div class="check-box-btn">
                          <input type="checkbox"
                                 id="{{item.id}}"
                                 [(ngModel)]="item.checked"
                                 (change)="onCheckChange($event, item, statusMenu)"
                                 name="{{item.id}}" >
                          <label for="{{item.id}}" >{{item.label}}</label>
                        </div>
                      </div>
                      <div mat-menu-item class="dropdown-item" (click)="$event.stopPropagation();">
                        <div class="check-box-btn" >
                          <input type="checkbox"
                                 id="select_all"
                                 [value]="'select_all'"
                                 (change)="selectAllColumns()"
                                 name="select_all" >
                          <label for="select_all" class="blue-text">Tout séléctionner</label>
                        </div>
                      </div>
                    </mat-menu>
                    <mat-menu #placeholder="matMenu" class="placeholder"></mat-menu>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of listItems">
                    <td data-title="Matricule" >{{item?.personal?.registration_number || 'N.R'}}</td>

                    <td>
                      <ng-template #infopopover>
                        <div class="title">
                          {{item?.personal?.nom}} {{item?.personal?.prenom}}
                          <span class="light-text">({{item?.personal?.registration_number}})</span>
                        </div>
                        <table class="small-table">
                          <tr>
                            <td>
                              <div class="label blue-text" >Date d'entrée</div>
                            </td>
                            <td>
                              <div class="value" >{{item?.personal?.entry_date | dateMessage}}</div>
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <div class="label blue-text" >Société</div>
                            </td>
                            <td>
                              <div class="value" >{{item?.personal?.entity}}</div>
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <div class="label blue-text" >Centre de profit</div>
                            </td>
                            <td>
                              <div class="value" >{{item?.personal?.manager}}</div>
                            </td>
                          </tr>
                        </table>
                        <ng-container
                            *ngIf="item?.personal?.has_interview_to_validate ||
                               item?.personal?.has_medical_visit_to_validate ||
                               item?.personal?.has_trial_period_to_validate"
                          >
                            <div class="item danger-text text-decoration-underline">Informations manquantes</div>
                            <table class="small-table">
                              <tr *ngIf="item?.personal?.has_trial_period_to_validate">
                                <td>
                                  <div class="item danger-text">
                                    Période d'essai à valider &nbsp;&nbsp;
                                    <a
                                      target="_blank"
                                      [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.periode_essai]"
                                    >
                                      <i class="fa fa-external-link danger-icon"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr>
                              <tr *ngIf="item?.personal?.has_interview_to_validate">
                                <td>
                                  <div class="item danger-text">
                                    Entretien à effectuer &nbsp;&nbsp;
                                    <a
                                      target="_blank"
                                      [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.entretien]"
                                    >
                                      <i class="fa fa-external-link danger-icon"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr>
                              <tr *ngIf="item?.personal?.has_medical_visit_to_validate">
                                <td>
                                  <div class="item danger-text" >
                                    Visites médicales à valider &nbsp;&nbsp;
                                    <a
                                      target="_blank"
                                      [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.visite_medicale]"
                                    >
                                      <i class="fa fa-external-link danger-icon"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr>
                            </table>
                          </ng-container>
                      </ng-template>
                      <div class="photo-cell pointer">
                        <div class="photo">
                          <div class="img-container">
                            <img
                              [ngbPopover]="infopopover"
                              placement="right"
                              container="body"
                              [autoClose]="true"
                              [attr.src]="item?.personal?.photo_profile ? (item?.personal?.photo_profile |
                        getPhotoFromBackend: ('assets/images/'+(item?.personal?.civility === 'Mme' ? 'woman.png': 'man.png')) |
                        async) : ('assets/images/'+(item?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png'))"
                            />
                            <i class="fa fa-exclamation-triangle danger-icon"
                               *ngIf="item?.personal?.has_interview_to_validate || item?.personal?.has_medical_visit_to_validate || item?.personal?.has_trial_period_to_validate">
                              ></i>
                          </div>
                        </div>
                        <div class="name"
                             [routerLink]="['/users/details']" [queryParams]="{step: STEPS.entree, user_id: item?.personal_id}"
                        >{{item?.personal?.nom}} {{item?.personal?.prenom}}</div>
                      </div>
                    </td>

                    <td data-title="Entité" >{{item?.entity.label || 'N.R'}}</td>
                    <td data-title="Entité" >{{item?.siege?.label || 'N.R'}}</td>
                    <td data-title="Entité" >{{ (item?.entry_date | dateMessage) || 'N.R'}}</td>
                    <td data-title="Entité" >{{item?.manager?.full_name || 'N.R'}}</td>
                    <td data-title="Entité" >{{item?.contrat.label || 'N.R'}}</td>
                    <td data-title="Entité" >{{item?.status?.label || 'N.R'}}</td>
                    <ng-container *ngFor="let extraColumn of getActiveColumns('columns_entree')">
                        <td>
                          <div class="check-box-btn"  [matTooltip]="item?.slug_actions[extraColumn.slug]?.user ? ('Validé par ' +item?.slug_actions?.[extraColumn.slug]?.user?.prenom + ' ' + item?.slug_actions?.[extraColumn.slug]?.user?.nom + ' le '+ (item?.slug_actions?.[extraColumn.slug]?.done_at | dateMessage)):''">
                            <input type="checkbox"
                                   class="small-checkbox"
                                   *ngIf="item.slug_actions[extraColumn.slug]"
                                   [disabled]="item?.slug_actions?.[extraColumn.slug]?.checked"
                                   [ngClass]="{'disabled': item?.slug_actions?.[extraColumn.slug]?.checked}"
                                   id="with_inactive_cp"
                                   (change)="markActionAsDone(item.slug_actions[extraColumn.slug].id,item.slug_actions[extraColumn.slug].checked)"
                                   [checked]="item?.slug_actions?.[extraColumn.slug]?.checked"
                                   [(ngModel)]="item.slug_actions[extraColumn.slug].checked"
                                   name="checbox_" >
                          </div>
                        </td>
                    </ng-container>
                    <td>
                      <div class="actions">

                        <!--                              <span class="d-none d-lg-flex">Détails</span>-->

                        <!--                                <ng-container *ngIf="!user.blocked_at; else unlock">-->
                        <!--                                    <i class="fa fa-lock"-->
                        <!--                                       data-toggle="tooltip"-->
                        <!--                                       data-placement="top"-->
                        <!--                                       (click)="askBlockUser(user.id)"-->
                        <!--                                       title="{{'DISABLE ACCOUNT' | translate}}"></i>-->
                        <!--                                </ng-container>-->
                        <!--                                <ng-template #unlock>-->
                        <!--                                    <i class="fa fa-unlock"-->
                        <!--                                       data-toggle="tooltip"-->
                        <!--                                       data-placement="top"-->
                        <!--                                       (click)="askUnBlockUser(user.id)"-->
                        <!--                                       title="{{'ENABLE ACCOUNT' | translate}}"></i>-->
                        <!--                                </ng-template>-->
                        <!--                                <i class="fa fa-trash"-->
                        <!--                                   (click)="archive(user.id)"-->
                        <!--                                   data-toggle="tooltip"-->
                        <!--                                   data-placement="top"-->
                        <!--                                   title="{{'DELETE' | translate}}"></i>-->
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </ng-container>
            <ng-container *ngSwitchCase="'sortie'">
              <table class="table-responsive card-list-table table_entree">
                <thead>
                  <tr>
                  <th>
                    Salarié
                  </th>
                  <th>
                    Matricule
                  </th>
                  <th>
                    Société
                  </th>
                  <th>
                    Siège
                  </th>
                  <th>
                    Date d'entrée
                  </th>
                  <th>
                    Centre de profit
                  </th>
                  <th>
                    Date de reception du courier
                  </th>
                  <th>
                    Motif
                  </th>
                  <th>
                    Fin normal préavis
                  </th>
                  <th>
                    Date limite de réponse
                  </th>
                  <th>
                    Date de sortie
                  </th>
                  <th>
                    Docs
                  </th>
                  <ng-container *ngFor="let extraColumn of getActiveColumns('columns_entree')">
                    <th>
                      {{extraColumn.label}}
                    </th>
                </ng-container>
  <!--              <th style="text-align: center" [matTooltip]="'Selectionnez les colonnes que vous souhaitez visualiser'" class="sticky th-btn" width="2%" style="position: sticky;right:-80px;" [matMenuTriggerFor]="statusMenu">-->
  <!--                <i class="fa fa-filter" ></i>-->
  <!--              </th>-->
                  <th  style="width:2%"  class="sticky">
                    <div style="text-align: center;position: sticky;right:-80px;" [matTooltip]="'Selectionnez les colonnes que vous souhaitez visualiser'" [matMenuTriggerFor]="statusMenu">
                      <i class="fa fa-filter primary-icon pointer" ></i><span class="link">Personnaliser</span>
                    </div>
                  </th>
                <mat-menu #statusMenu="matMenu" [class]="'profile-menu'">
                  <div mat-menu-item class="dropdown-item" *ngFor="let item of columns_entree" (click)="$event.stopPropagation()">
                    <div class="check-box-btn">
                      <input type="checkbox"
                             id="{{item.id}}"
                             [(ngModel)]="item.checked"
                             (change)="onCheckChange($event, item, statusMenu)"
                             name="{{item.id}}" >
                      <label for="{{item.id}}" >{{item.label}}</label>
                    </div>
                  </div>
                  <div mat-menu-item class="dropdown-item" (click)="$event.stopPropagation();">
                    <div class="check-box-btn" >
                      <input type="checkbox"
                             id="select_all"
                             [value]="'select_all'"
                             (change)="selectAllColumns()"
                             name="select_all" >
                      <label for="select_all" class="blue-text">Tout séléctionner</label>
                    </div>
                  </div>
                </mat-menu>
                <mat-menu #placeholder="matMenu" class="placeholder"></mat-menu>

                </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of listItems" >
                    <td>
                      <ng-template #infopopover>
                        <div class="title">
                          {{item?.personal?.nom}} {{item?.personal?.prenom}}
                          <span class="light-text">({{item?.personal?.registration_number}})</span>
                        </div>
                        <table class="small-table">
                          <tr>
                            <td>
                              <div class="label blue-text" >Date d'entrée</div>
                            </td>
                            <td>
                              <div class="value" >{{item?.personal?.entry_date | dateMessage}}</div>
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <div class="label blue-text" >Société</div>
                            </td>
                            <td>
                              <div class="value" >{{item?.personal?.entity?.label}}</div>
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <div class="label blue-text" >Centre de profit</div>
                            </td>
                            <td>
                              <div class="value" >{{item?.personal?.manager?.full_name}}</div>
                            </td>
                          </tr>
                        </table>
                        <ng-container
                            *ngIf="item?.personal?.has_interview_to_validate || item?.personal?.has_medical_visit_to_validate ||  item?.personal?.has_trial_period_to_validate">
                            <div class="item danger-text text-decoration-underline">Informations manquantes</div>
                            <table class="small-table">
                              <tr *ngIf="item?.personal?.has_trial_period_to_validate">
                                <td>
                                  <div class="item danger-text">
                                    Période d'essai à valider &nbsp;&nbsp;
                                    <a
                                      target="_blank"
                                      [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.periode_essai]"
                                    >
                                      <i class="fa fa-external-link danger-icon"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr>
                              <tr *ngIf="item?.personal?.has_interview_to_validate">
                                <td>
                                  <div class="item danger-text">
                                    Entretien à effectuer &nbsp;&nbsp;
                                    <a
                                      target="_blank"
                                      [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.entretien]">
                                    
                                      <i class="fa fa-external-link danger-icon"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr>
                              <tr *ngIf="item?.personal?.has_medical_visit_to_validate">
                                <td>
                                  <div class="item danger-text" >
                                    Visites médicales à valider &nbsp;&nbsp;
                                    <a
                                      target="_blank"
                                      [routerLink]="['/users/details?user_id'+item?.personal?.id+'&step='+STEPS.visite_medicale]">
                                      
                                      <i class="fa fa-external-link danger-icon"></i>
                                    </a>
                                  </div>
                                </td>
                              </tr>
                            </table>
                          </ng-container>
                      </ng-template>

                      <div class="photo-cell pointer">
                        <div class="photo">
                          <div class="img-container">
                            <img
                              [ngbPopover]="infopopover"
                              placement="right"
                              container="body"
                              [autoClose]="true"
                              [attr.src]="item?.personal?.photo_profile ? (item?.personal?.photo_profile |
                          getPhotoFromBackend: ('assets/images/'+(item?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png')) |
                          async) : ('assets/images/'+(item?.personal?.civility === 'Mme.' ? 'woman.png': 'man.png'))"
                            />
                            <i class="fa fa-exclamation-triangle danger-icon"
                               *ngIf="item?.personal?.has_interview_to_validate || item?.personal?.has_medical_visit_to_validate || item?.personal?.has_trial_period_to_validate">
                            ></i>
                          </div>
                        </div>
                        <div class="name"
                             [routerLink]="['/users/details']" [queryParams]="{step: STEPS.sortie, user_id: item?.personal_id}"
                        >
                          {{item?.personal?.nom || 'N.R'}}
                          {{item?.personal?.prenom || 'N.R'}}
                        </div>
                      </div>
                    </td>
                    <td data-title="Matricule" >
                      {{item?.personal?.registration_number || 'N.R'}}
                    </td>
                    <td data-title="Entité" >{{item?.entrance?.entity?.label || item?.personal?.entity?.label + "perso ::"|| 'N.R'}}</td>
                    <td data-title="Entité" >{{item?.entrance?.siege?.label ||  item?.personal?.siege?.label + "perso ::"  || 'N.R'}}</td>
                    <td data-title="Entité" > {{(item?.entrance?.entry_date | dateMessage) || (item?.personal?.entry_date + "perso ::" | dateMessage) || 'N.R'}}</td>
                    <td data-title="Entité" >{{item?.entrance?.manager?.full_name || item?.personal?.manager?.full_name  + "perso ::" || 'N.R'}}</td>
                    <td data-title="Entité" >{{ (item?.requested_at | dateMessage) || 'N.R'}}</td>
                    <td data-title="Entité" >{{item?.motif?.label || 'N.R'}}</td>
                    <td data-title="Entité" >{{ (item?.end_date_preavis | dateMessage) || 'N.R'}}</td>
                    <td data-title="Entité" >{{ (item?.date_limite_reponse | dateMessage) || 'N.R'}}</td>
                    <td data-title="Entité" >{{ (item?.end_date | dateMessage) || 'N.R'}}</td>
                    <td data-title="Entité" >
                        <i class="icon-attachment primary-icon"></i>
                    </td>
                    <ng-container *ngFor="let extraColumn of getActiveColumns('columns_entree')">
                      <td>
                        <div class="check-box-btn"  [matTooltip]="item?.slug_actions[extraColumn.slug]?.user ? ('Validé par ' +item?.slug_actions?.[extraColumn.slug]?.user?.prenom + ' ' + item?.slug_actions?.[extraColumn.slug]?.user?.nom + ' le '+ (item?.slug_actions?.[extraColumn.slug]?.done_at | dateMessage)):''">
                          <input type="checkbox"
                                 class="small-checkbox"
                                 *ngIf="item.slug_actions[extraColumn.slug]"
                                 [disabled]="item?.slug_actions?.[extraColumn.slug]?.checked"
                                 [ngClass]="{'disabled': item?.slug_actions?.[extraColumn.slug]?.checked}"
                                 id="with_inactive_cp"
                                 (change)="markActionAsDone(item.slug_actions[extraColumn.slug].id,item.slug_actions[extraColumn.slug].checked)"
                                 [checked]="item?.slug_actions?.[extraColumn.slug]?.checked"
                                 [(ngModel)]="item.slug_actions[extraColumn.slug].checked"
                                 name="checbox_" >
                        </div>
                      </td>
                  </ng-container>
                    <td>
                      <div class="actions">
                        <i class="icon-edit primary-icon pointer" (click)="openEditModal('sortie', item)"></i>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </ng-container>
            <ng-container *ngSwitchDefault>
              <ng-container *ngTemplateOutlet="emptyState"></ng-container>
            </ng-container>
          </ng-container>
        </div>
      </div>
      <div class="footer" *ngIf="listItems?.length>0">

        <app-pagination name="pagination"
                        (change)="changePagination()"
                        [(ngModel)]="pagination"
                        ngDefaultControl>
        </app-pagination>
        <div class="right-buttons flex-end">
  <!--        <app-button-->
  <!--          [text]="'Importer'"-->
  <!--          [type]="'tertiary_inverse'"-->
  <!--          [iconLeft]="'icon-file'"-->
  <!--          [customStyle]="{'white-space': 'nowrap'}"-->
  <!--        ></app-button>&nbsp;-->
          <app-button
            [text]="'Exporter'"
            [type]="'tertiary_inverse'"
            [iconLeft]="'icon-file'"
            [customStyle]="{'white-space': 'nowrap'}"
            (onClick)="export()"
          ></app-button>
        </div>
      </div>
    </ng-container>
  </div>

  <ng-template #emptyState>
    <app-centred-message
      [image]="'images/user_empty_state.svg'"
      [message]="( 'Aucun élément trouvé pour le moment' | translate )"
    ></app-centred-message>
  </ng-template>

  <ng-template #loadingTemplate>
    <div class="d-flex w-100 h-100 align-items-center justify-content-center">
      <img src="assets/images/loading.svg" style="height: 100px;" />
    </div>
  </ng-template>
